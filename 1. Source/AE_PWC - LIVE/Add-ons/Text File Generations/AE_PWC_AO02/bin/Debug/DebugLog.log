[11/28/2016 17:32:52][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 17:32:52][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 17:32:53][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 17:32:53][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 17:33:09][                                  Main()] Starting Addon startup function
[11/28/2016 17:33:09][                                  Main()] Initializing public SBO Application object
[11/28/2016 17:33:09][                                  Main()] Retriving SBO application company handle
[11/28/2016 17:33:09][                                  Main()] Retrived SBO application company handle
[11/28/2016 17:33:09][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 17:33:09][                      ConnectDICompSSO()] Starting function
[11/28/2016 17:33:14][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 17:33:14][                                  Main()] Creating Event handler class
[11/28/2016 17:33:14][                      Class_Initialize()] Starting function
[11/28/2016 17:33:14][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 17:33:14][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 17:33:14][                                  Main()] Calling AddMenuItems()
[11/28/2016 17:33:14][                                  Main()] Calling SetApplication Function
[11/28/2016 17:33:14][                                  Main()] Addon started successfully
[11/28/2016 17:33:34][              SBO_Application_AppEvent()] Starting function
[11/28/2016 17:34:04][                                  Main()] Starting Addon startup function
[11/28/2016 17:34:04][                                  Main()] Initializing public SBO Application object
[11/28/2016 17:34:04][                                  Main()] Retriving SBO application company handle
[11/28/2016 17:34:04][                                  Main()] Retrived SBO application company handle
[11/28/2016 17:34:04][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 17:34:04][                      ConnectDICompSSO()] Starting function
[11/28/2016 17:34:09][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 17:34:09][                                  Main()] Creating Event handler class
[11/28/2016 17:34:09][                      Class_Initialize()] Starting function
[11/28/2016 17:34:09][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 17:34:09][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 17:34:09][                                  Main()] Calling AddMenuItems()
[11/28/2016 17:34:09][                                  Main()] Calling SetApplication Function
[11/28/2016 17:34:09][                                  Main()] Addon started successfully
[11/28/2016 17:34:26][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 17:34:26][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 17:34:26][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 17:34:40][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 17:35:00][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 17:35:00][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:35:00][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:35:01][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:35:01][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 17:35:07][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 17:35:11][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 17:35:14][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 17:35:14][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:35:14][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:35:14][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:35:15][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 17:44:15][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 17:44:23][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 17:44:23][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:44:23][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:44:23][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('52114') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('52114') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:44:23][      Summary Report Show button click()] Completed with ERROR
[11/28/2016 17:44:27][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 17:44:31][             SBO_Application_ItemEvent()] Added 52116
[11/28/2016 17:44:33][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 17:44:33][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:44:33][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:44:33][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('52114') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52116')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('52114') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52116')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:44:33][      Summary Report Show button click()] Completed with ERROR
[11/28/2016 17:44:36][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 17:44:36][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:44:36][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:44:36][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('52114') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('52114') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''52114'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:44:37][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('52114') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('52114') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('52114') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('52114') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('52114') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 17:45:04][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 17:45:17][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 17:45:17][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:45:17][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:45:17][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:45:17][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 17:45:28][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 17:45:31][             SBO_Application_ItemEvent()] Added 52114
[11/28/2016 17:45:34][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 17:45:34][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:45:34][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:45:34][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:45:35][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 17:45:53][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 17:45:53][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:45:53][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:45:53][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:45:54][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 17:46:03][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 17:46:06][             SBO_Application_ItemEvent()] Added 52111
[11/28/2016 17:46:08][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 17:46:08][             CostAllocation_Validation()] Starting Function
[11/28/2016 17:46:08][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 17:46:08][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 17:46:09][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 17:46:29][                       MAtrixToDataTable] Starting Function
[11/28/2016 17:46:29][           ConvertRecordsetToDataTable()] Starting Fuction 
[11/28/2016 17:46:29][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[11/28/2016 17:46:29][           ConvertRecordsetToDataTable()] Starting Fuction 
[11/28/2016 17:46:29][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[11/28/2016 17:46:29][           ConvertRecordsetToDataTable()] Starting Fuction 
[11/28/2016 17:46:30][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[11/28/2016 17:46:31][                       MAtrixToDataTable] Completed with SUCCESS 
[11/28/2016 17:46:31][             SBO_Application_ItemEvent()] Calling ConnectToTargetCompany()
[11/28/2016 17:46:31][                ConnectToTargetCompany()] Starting function
[11/28/2016 17:46:31][                ConnectToTargetCompany()] Initializing the Company Object
[11/28/2016 17:46:31][                ConnectToTargetCompany()] Assigning the representing database name
[11/28/2016 17:46:31][                ConnectToTargetCompany()] Connecting to the Company Database. GHRS
[11/28/2016 17:46:34][                ConnectToTargetCompany()] Completed with SUCCESS
[11/28/2016 17:46:34][             SBO_Application_ItemEvent()] Starts JV Group 
[11/28/2016 17:46:34][             SBO_Application_ItemEvent()] Starts NON JV Group 
[11/28/2016 17:46:34][             SBO_Application_ItemEvent()] NON JV Group Count 9
[11/28/2016 17:46:34][             SBO_Application_ItemEvent()] Calling JournalEntry_Posting_NONJV_Source()
[11/28/2016 17:46:34][       JournalEntry_Posting_NONJV_Source] Starting Function 
[11/28/2016 17:46:34][       JournalEntry_Posting_NONJV_Source] Attempting to Add the Journal Entry
[11/28/2016 17:46:35][       JournalEntry_Posting_NONJV_Source] Completed with SUCCESS 
[11/28/2016 17:46:35][       JournalEntry_Posting_NONJV_Source] Journal Entry DocEntry  219
[11/28/2016 17:46:35][             SBO_Application_ItemEvent()] Calling JournalEntry_Posting_NONJV_Target()
[11/28/2016 17:46:35][       JournalEntry_Posting_NONJV_Target] Starting Function 
[11/28/2016 17:46:35][       JournalEntry_Posting_NONJV_Target] Attempting to Add the Journal Entry
[11/28/2016 17:46:35][       JournalEntry_Posting_NONJV_Target] Completed with SUCCESS 
[11/28/2016 17:46:35][       JournalEntry_Posting_NONJV_Target] Journal Entry DocEntry  121	1
[11/28/2016 17:46:35][             SBO_Application_ItemEvent()] exporting into Cost Allocation Table insert into [@AB_COSTALLOCATION] (Code, Name, U_Transid, U_PrcCode , U_OcrCode3, U_SourceOcrcode3)  values ((select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]) ,(select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]),'201','52111' , 'HC1' , '52111')insert into [@AB_COSTALLOCATION] (Code, Name, U_Transid, U_PrcCode , U_OcrCode3, U_SourceOcrcode3)  values ((select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]) ,(select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]),'134','52111' , 'HC1' , '52111')insert into [@AB_COSTALLOCATION] (Code, Name, U_Transid, U_PrcCode , U_OcrCode3, U_SourceOcrcode3)  values ((select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]) ,(select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]),'100','52111' , 'HC1' , '52111')insert into [@AB_COSTALLOCATION] (Code, Name, U_Transid, U_PrcCode , U_OcrCode3, U_SourceOcrcode3)  values ((select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]) ,(select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]),'99','52111' , 'HC1' , '52111')insert into [@AB_COSTALLOCATION] (Code, Name, U_Transid, U_PrcCode , U_OcrCode3, U_SourceOcrcode3)  values ((select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]) ,(select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]),'98','52111' , 'HC1' , '52111')insert into [@AB_COSTALLOCATION] (Code, Name, U_Transid, U_PrcCode , U_OcrCode3, U_SourceOcrcode3)  values ((select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]) ,(select isnull(max(cast(Code as numeric )),0) + 1 from [@AB_COSTALLOCATION]),'118','52111' , 'HC1' , '52111')
[11/28/2016 17:46:35][             SBO_Application_ItemEvent()] Commit transaction on company database GHRS
[11/28/2016 17:46:35][             SBO_Application_ItemEvent()] Disconnecting company database GHRS
[11/28/2016 17:46:35][             SBO_Application_ItemEvent()] SummaryReport show button click SELECT cast(Number as varchar(30)) 'SAP Invoice Number'  , REF2 'Vendor Invoice Number' , TAXDATE 'Vendor Invoice Date' ,REFDATE 'SAP Posting Date'  ,'JE' 'Vendor Name',MEMO 'Journal Remark' ,  [OcrCode3] 'Distribution Code', '' 'Purchasing Department', plan_id [Expenses]   from ( SELECT c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + ' - ' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],    sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total ,  sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  where  b.OcrCode3 in ('') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '' and b.Account <= '' and c.transType IN ('0')  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode]    ) x 
[11/28/2016 17:46:37][             SBO_Application_ItemEvent()] Journal Entries Created Successfully ....!
[11/28/2016 17:46:45][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 17:46:45][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 17:46:45][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 17:46:45][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 18:10:26][                                  Main()] Starting Addon startup function
[11/28/2016 18:10:26][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:10:26][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:10:27][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:10:27][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:10:27][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:10:31][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:10:31][                                  Main()] Creating Event handler class
[11/28/2016 18:10:31][                      Class_Initialize()] Starting function
[11/28/2016 18:10:31][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:10:31][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:10:31][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:10:31][                                  Main()] Calling SetApplication Function
[11/28/2016 18:10:31][                                  Main()] Addon started successfully
[11/28/2016 18:10:40][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:10:50][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 18:10:50][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:10:50][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:10:50][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:10:51][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:11:01][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:11:05][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:11:07][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:11:07][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:11:07][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:11:07][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:11:08][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:12:03][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 18:12:03][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 18:12:03][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 18:12:03][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 18:21:01][                                  Main()] Starting Addon startup function
[11/28/2016 18:21:01][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:21:01][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:21:01][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:21:01][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:21:01][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:21:07][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:21:07][                                  Main()] Creating Event handler class
[11/28/2016 18:21:07][                      Class_Initialize()] Starting function
[11/28/2016 18:21:07][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:21:07][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:21:07][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:21:07][                                  Main()] Calling SetApplication Function
[11/28/2016 18:21:07][                                  Main()] Addon started successfully
[11/28/2016 18:21:21][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:21:34][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 18:21:34][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:21:34][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:21:34][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:21:35][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:21:43][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:21:48][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:21:50][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:21:50][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:21:50][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:21:50][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:21:50][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:22:58][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:22:58][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:22:58][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:22:58][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:23:48][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:26:12][                                  Main()] Starting Addon startup function
[11/28/2016 18:26:12][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:26:12][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:26:13][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:26:13][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:26:13][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:26:18][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:26:18][                                  Main()] Creating Event handler class
[11/28/2016 18:26:18][                      Class_Initialize()] Starting function
[11/28/2016 18:26:18][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:26:18][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:26:18][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:26:18][                                  Main()] Calling SetApplication Function
[11/28/2016 18:26:18][                                  Main()] Addon started successfully
[11/28/2016 18:26:31][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 18:26:31][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 18:26:31][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 18:26:40][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:26:59][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 18:27:00][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:27:00][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:27:00][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:27:00][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:27:09][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:27:15][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:27:17][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:27:17][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:27:17][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:27:17][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:27:18][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:28:43][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:28:43][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:28:43][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:28:43][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:28:43][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:30:02][                                  Main()] Starting Addon startup function
[11/28/2016 18:30:02][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:30:02][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:30:02][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:30:02][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:30:02][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:30:07][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:30:07][                                  Main()] Creating Event handler class
[11/28/2016 18:30:07][                      Class_Initialize()] Starting function
[11/28/2016 18:30:07][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:30:07][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:30:07][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:30:07][                                  Main()] Calling SetApplication Function
[11/28/2016 18:30:07][                                  Main()] Addon started successfully
[11/28/2016 18:30:10][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:30:23][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:30:26][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:30:30][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:30:30][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:30:30][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:30:30][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:30:30][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:33:11][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:33:11][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:33:11][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:33:11][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:33:11][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:38:20][                                  Main()] Starting Addon startup function
[11/28/2016 18:38:20][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:38:20][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:38:21][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:38:21][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:38:21][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:38:26][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:38:26][                                  Main()] Creating Event handler class
[11/28/2016 18:38:26][                      Class_Initialize()] Starting function
[11/28/2016 18:38:26][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:38:26][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:38:26][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:38:26][                                  Main()] Calling SetApplication Function
[11/28/2016 18:38:26][                                  Main()] Addon started successfully
[11/28/2016 18:38:32][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 18:38:32][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 18:38:32][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 18:38:40][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:38:58][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 18:38:58][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:38:58][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:38:58][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:38:59][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:39:02][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:39:06][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:39:14][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:39:14][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:39:14][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:39:14][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:39:14][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:40:52][                                  Main()] Starting Addon startup function
[11/28/2016 18:40:52][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:40:52][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:40:52][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:40:52][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:40:52][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:40:57][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:40:57][                                  Main()] Creating Event handler class
[11/28/2016 18:40:57][                      Class_Initialize()] Starting function
[11/28/2016 18:40:57][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:40:57][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:40:57][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:40:57][                                  Main()] Calling SetApplication Function
[11/28/2016 18:40:57][                                  Main()] Addon started successfully
[11/28/2016 18:40:59][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:41:12][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:41:15][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:41:18][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:41:18][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:41:18][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:41:18][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:41:19][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:53:14][                                  Main()] Starting Addon startup function
[11/28/2016 18:53:14][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:53:14][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:53:14][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:53:14][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:53:14][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:53:19][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:53:19][                                  Main()] Creating Event handler class
[11/28/2016 18:53:19][                      Class_Initialize()] Starting function
[11/28/2016 18:53:19][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:53:19][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:53:19][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:53:19][                                  Main()] Calling SetApplication Function
[11/28/2016 18:53:19][                                  Main()] Addon started successfully
[11/28/2016 18:53:20][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:53:35][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:53:38][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:53:40][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:53:40][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:53:40][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:53:40][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:53:41][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:56:47][                                  Main()] Starting Addon startup function
[11/28/2016 18:56:47][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:56:47][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:56:48][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:56:48][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:56:48][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:56:53][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:56:53][                                  Main()] Creating Event handler class
[11/28/2016 18:56:53][                      Class_Initialize()] Starting function
[11/28/2016 18:56:53][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:56:53][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:56:53][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:56:53][                                  Main()] Calling SetApplication Function
[11/28/2016 18:56:53][                                  Main()] Addon started successfully
[11/28/2016 18:56:55][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:57:12][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:57:15][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:57:18][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:57:18][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:57:18][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:57:18][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:57:18][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 18:58:50][                                  Main()] Starting Addon startup function
[11/28/2016 18:58:50][                                  Main()] Initializing public SBO Application object
[11/28/2016 18:58:50][                                  Main()] Retriving SBO application company handle
[11/28/2016 18:58:50][                                  Main()] Retrived SBO application company handle
[11/28/2016 18:58:50][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 18:58:50][                      ConnectDICompSSO()] Starting function
[11/28/2016 18:58:55][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 18:58:55][                                  Main()] Creating Event handler class
[11/28/2016 18:58:55][                      Class_Initialize()] Starting function
[11/28/2016 18:58:55][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 18:58:55][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 18:58:55][                                  Main()] Calling AddMenuItems()
[11/28/2016 18:58:55][                                  Main()] Calling SetApplication Function
[11/28/2016 18:58:55][                                  Main()] Addon started successfully
[11/28/2016 18:59:03][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 18:59:16][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 18:59:19][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 18:59:23][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 18:59:23][             CostAllocation_Validation()] Starting Function
[11/28/2016 18:59:23][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 18:59:23][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 18:59:23][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:02:36][                                  Main()] Starting Addon startup function
[11/28/2016 19:02:36][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:02:37][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:02:37][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:02:37][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:02:37][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:02:42][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:02:42][                                  Main()] Creating Event handler class
[11/28/2016 19:02:42][                      Class_Initialize()] Starting function
[11/28/2016 19:02:42][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:02:42][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:02:42][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:05:53][                                  Main()] Starting Addon startup function
[11/28/2016 19:05:53][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:05:53][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:05:53][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:05:53][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:05:53][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:05:57][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:05:57][                                  Main()] Creating Event handler class
[11/28/2016 19:05:57][                      Class_Initialize()] Starting function
[11/28/2016 19:05:57][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:05:57][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:05:57][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:08:50][                                  Main()] Starting Addon startup function
[11/28/2016 19:08:50][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:08:50][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:08:51][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:08:52][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:08:52][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:08:57][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:08:57][                                  Main()] Creating Event handler class
[11/28/2016 19:08:57][                      Class_Initialize()] Starting function
[11/28/2016 19:08:57][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:08:57][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:08:57][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:08:57][                                  Main()] Calling SetApplication Function
[11/28/2016 19:08:57][                                  Main()] Addon started successfully
[11/28/2016 19:09:04][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:09:19][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:09:22][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:09:24][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:09:24][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:09:24][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:09:24][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:09:24][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:11:36][                                  Main()] Starting Addon startup function
[11/28/2016 19:11:36][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:11:36][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:11:36][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:11:36][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:11:36][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:11:41][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:11:41][                                  Main()] Creating Event handler class
[11/28/2016 19:11:41][                      Class_Initialize()] Starting function
[11/28/2016 19:11:41][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:11:41][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:11:41][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:11:41][                                  Main()] Calling SetApplication Function
[11/28/2016 19:11:41][                                  Main()] Addon started successfully
[11/28/2016 19:11:45][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:11:58][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:12:01][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:12:03][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:12:03][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:12:03][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:12:03][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:12:04][      Summary Report Show button click()] Completed with ERROR
[11/28/2016 19:12:45][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:12:45][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:12:45][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:12:45][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:14:21][                                  Main()] Starting Addon startup function
[11/28/2016 19:14:21][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:14:21][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:14:22][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:14:22][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:14:22][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:14:27][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:14:27][                                  Main()] Creating Event handler class
[11/28/2016 19:14:27][                      Class_Initialize()] Starting function
[11/28/2016 19:14:27][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:14:27][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:14:27][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:14:27][                                  Main()] Calling SetApplication Function
[11/28/2016 19:14:27][                                  Main()] Addon started successfully
[11/28/2016 19:14:33][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 19:14:33][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 19:14:33][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 19:14:40][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:15:03][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 19:15:03][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:15:03][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:15:03][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:15:03][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:15:11][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:15:15][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:15:17][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:15:17][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:15:17][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:15:17][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:15:47][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:17:34][                                  Main()] Starting Addon startup function
[11/28/2016 19:17:34][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:17:34][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:17:35][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:17:35][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:17:35][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:17:40][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:17:40][                                  Main()] Creating Event handler class
[11/28/2016 19:17:40][                      Class_Initialize()] Starting function
[11/28/2016 19:17:40][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:17:40][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:17:40][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:17:40][                                  Main()] Calling SetApplication Function
[11/28/2016 19:17:40][                                  Main()] Addon started successfully
[11/28/2016 19:17:41][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:17:51][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:17:54][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:17:58][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:17:58][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:17:58][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:17:58][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:19:09][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:19:30][                                  Main()] Starting Addon startup function
[11/28/2016 19:19:30][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:19:30][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:19:31][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:19:31][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:19:31][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:19:36][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:19:36][                                  Main()] Creating Event handler class
[11/28/2016 19:19:36][                      Class_Initialize()] Starting function
[11/28/2016 19:19:36][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:19:36][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:19:36][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:19:36][                                  Main()] Calling SetApplication Function
[11/28/2016 19:19:36][                                  Main()] Addon started successfully
[11/28/2016 19:19:38][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:19:52][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:19:55][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:19:57][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:19:57][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:19:57][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:19:57][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:21:04][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:21:26][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:21:26][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:21:26][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:21:26][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:22:22][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:22:47][                                  Main()] Starting Addon startup function
[11/28/2016 19:22:47][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:22:47][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:22:47][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:22:47][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:22:47][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:22:53][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:22:53][                                  Main()] Creating Event handler class
[11/28/2016 19:22:53][                      Class_Initialize()] Starting function
[11/28/2016 19:22:53][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:22:53][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:22:53][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:22:53][                                  Main()] Calling SetApplication Function
[11/28/2016 19:22:53][                                  Main()] Addon started successfully
[11/28/2016 19:22:55][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:23:05][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:23:08][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:23:11][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:23:11][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:23:11][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:23:11][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:33:32][                                  Main()] Starting Addon startup function
[11/28/2016 19:33:32][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:33:32][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:33:33][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:33:33][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:33:33][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:33:38][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:33:38][                                  Main()] Creating Event handler class
[11/28/2016 19:33:38][                      Class_Initialize()] Starting function
[11/28/2016 19:33:38][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:33:38][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:33:38][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:33:38][                                  Main()] Calling SetApplication Function
[11/28/2016 19:33:38][                                  Main()] Addon started successfully
[11/28/2016 19:33:48][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 19:33:48][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/28/2016 19:33:48][             SBO_Application_MenuEvent()] Starting function
[11/28/2016 19:33:55][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:34:15][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 19:34:15][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:34:15][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:34:15][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:34:15][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:34:19][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:34:21][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:34:24][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:34:24][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:34:24][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:34:24][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:34:58][      Summary Report Show button click()] Completed with ERROR
[11/28/2016 19:35:53][                                  Main()] Starting Addon startup function
[11/28/2016 19:35:53][                                  Main()] Initializing public SBO Application object
[11/28/2016 19:35:53][                                  Main()] Retriving SBO application company handle
[11/28/2016 19:35:54][                                  Main()] Retrived SBO application company handle
[11/28/2016 19:35:54][                                  Main()] Calling ConnectDICompSSO()
[11/28/2016 19:35:54][                      ConnectDICompSSO()] Starting function
[11/28/2016 19:35:59][                      ConnectDICompSSO()] Completed with SUCCESS
[11/28/2016 19:35:59][                                  Main()] Creating Event handler class
[11/28/2016 19:35:59][                      Class_Initialize()] Starting function
[11/28/2016 19:35:59][                      Class_Initialize()] Retriving SBO Application handle
[11/28/2016 19:35:59][                      Class_Initialize()] Completed with SUCCESS
[11/28/2016 19:35:59][                                  Main()] Calling AddMenuItems()
[11/28/2016 19:35:59][                                  Main()] Calling SetApplication Function
[11/28/2016 19:35:59][                                  Main()] Addon started successfully
[11/28/2016 19:36:03][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/28/2016 19:36:19][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 19:36:20][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:36:20][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:36:20][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:36:20][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:36:21][              Header Show button click()] Calling HeaderValidation()
[11/28/2016 19:36:21][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:36:21][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:36:21][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:36:21][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/28/2016 19:36:23][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/28/2016 19:36:27][             SBO_Application_ItemEvent()] Added 52113
[11/28/2016 19:36:30][      Summary Report Show button click()] Calling HeaderValidation()
[11/28/2016 19:36:30][             CostAllocation_Validation()] Starting Function
[11/28/2016 19:36:30][             CostAllocation_Validation()] Completed with SUCCESS
[11/28/2016 19:36:30][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/28/2016 19:37:42][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 17:48:04][                                  Main()] Starting Addon startup function
[11/29/2016 17:48:05][                                  Main()] Initializing public SBO Application object
[11/29/2016 17:48:05][                                  Main()] Retriving SBO application company handle
[11/29/2016 17:48:06][                                  Main()] Retrived SBO application company handle
[11/29/2016 17:48:06][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 17:48:06][                      ConnectDICompSSO()] Starting function
[11/29/2016 17:48:10][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 17:48:10][                                  Main()] Creating Event handler class
[11/29/2016 17:48:10][                      Class_Initialize()] Starting function
[11/29/2016 17:48:10][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 17:48:10][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 17:48:10][                                  Main()] Calling AddMenuItems()
[11/29/2016 17:48:12][                                  Main()] Calling SetApplication Function
[11/29/2016 17:48:12][                                  Main()] Addon started successfully
[11/29/2016 17:48:14][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 17:48:14][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/29/2016 17:48:14][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 17:48:22][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 17:48:22][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/29/2016 17:48:22][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 17:48:22][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/29/2016 17:49:06][                                  Main()] Starting Addon startup function
[11/29/2016 17:49:06][                                  Main()] Initializing public SBO Application object
[11/29/2016 17:49:06][                                  Main()] Retriving SBO application company handle
[11/29/2016 17:49:06][                                  Main()] Retrived SBO application company handle
[11/29/2016 17:49:06][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 17:49:06][                      ConnectDICompSSO()] Starting function
[11/29/2016 17:49:10][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 17:49:10][                                  Main()] Creating Event handler class
[11/29/2016 17:49:10][                      Class_Initialize()] Starting function
[11/29/2016 17:49:10][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 17:49:10][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 17:49:10][                                  Main()] Calling AddMenuItems()
[11/29/2016 17:49:11][                                  Main()] Calling SetApplication Function
[11/29/2016 17:49:11][                                  Main()] Addon started successfully
[11/29/2016 17:49:14][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 17:49:14][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/29/2016 17:49:14][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 17:49:23][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 17:49:42][              Header Show button click()] Calling HeaderValidation()
[11/29/2016 17:49:42][             CostAllocation_Validation()] Starting Function
[11/29/2016 17:49:42][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 17:49:42][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 17:49:43][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 17:49:53][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 17:49:57][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 17:49:59][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 17:49:59][             CostAllocation_Validation()] Starting Function
[11/29/2016 17:49:59][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 17:49:59][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 17:50:00][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 18:38:57][                                  Main()] Starting Addon startup function
[11/29/2016 18:38:58][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:38:58][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:38:58][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:38:58][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:38:58][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:39:02][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:39:02][                                  Main()] Creating Event handler class
[11/29/2016 18:39:02][                      Class_Initialize()] Starting function
[11/29/2016 18:39:02][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:39:02][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:39:02][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:39:02][                                  Main()] Calling SetApplication Function
[11/29/2016 18:39:02][                                  Main()] Addon started successfully
[11/29/2016 18:39:07][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:39:17][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:39:27][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:39:31][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:39:31][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:39:31][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:39:31][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:39:53][      Summary Report Show button click()] Completed with ERROR
[11/29/2016 18:40:44][                                  Main()] Starting Addon startup function
[11/29/2016 18:40:44][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:40:44][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:40:45][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:40:45][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:40:45][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:40:49][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:40:49][                                  Main()] Creating Event handler class
[11/29/2016 18:40:49][                      Class_Initialize()] Starting function
[11/29/2016 18:40:49][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:40:49][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:40:49][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:40:49][                                  Main()] Calling SetApplication Function
[11/29/2016 18:40:49][                                  Main()] Addon started successfully
[11/29/2016 18:40:55][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:41:07][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:41:11][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:41:14][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:41:14][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:41:14][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:41:14][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:41:30][      Summary Report Show button click()] Completed with ERROR
[11/29/2016 18:42:37][                                  Main()] Starting Addon startup function
[11/29/2016 18:42:37][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:42:37][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:42:37][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:42:37][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:42:37][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:42:41][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:42:41][                                  Main()] Creating Event handler class
[11/29/2016 18:42:41][                      Class_Initialize()] Starting function
[11/29/2016 18:42:41][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:42:41][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:42:41][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:42:41][                                  Main()] Calling SetApplication Function
[11/29/2016 18:42:41][                                  Main()] Addon started successfully
[11/29/2016 18:42:44][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:42:59][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:43:02][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:43:05][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:43:05][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:43:05][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:43:05][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:46:14][                                  Main()] Starting Addon startup function
[11/29/2016 18:46:14][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:46:14][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:46:15][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:46:15][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:46:15][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:46:19][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:46:19][                                  Main()] Creating Event handler class
[11/29/2016 18:46:19][                      Class_Initialize()] Starting function
[11/29/2016 18:46:19][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:46:19][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:46:19][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:46:19][                                  Main()] Calling SetApplication Function
[11/29/2016 18:46:19][                                  Main()] Addon started successfully
[11/29/2016 18:46:31][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 18:46:31][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/29/2016 18:46:31][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 18:46:38][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:46:56][              Header Show button click()] Calling HeaderValidation()
[11/29/2016 18:46:56][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:46:56][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:46:56][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:46:56][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 18:46:58][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:47:01][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:47:03][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:47:03][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:47:03][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:47:03][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:50:44][                                  Main()] Starting Addon startup function
[11/29/2016 18:50:44][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:50:44][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:50:45][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:50:45][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:50:45][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:50:49][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:50:49][                                  Main()] Creating Event handler class
[11/29/2016 18:50:49][                      Class_Initialize()] Starting function
[11/29/2016 18:50:49][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:50:49][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:50:49][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:50:49][                                  Main()] Calling SetApplication Function
[11/29/2016 18:50:49][                                  Main()] Addon started successfully
[11/29/2016 18:50:50][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 18:50:50][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/29/2016 18:50:50][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 18:50:58][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:51:18][              Header Show button click()] Calling HeaderValidation()
[11/29/2016 18:51:18][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:51:18][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:51:18][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:51:18][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 18:51:21][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:51:24][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:51:27][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:51:27][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:51:27][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:51:27][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:51:27][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 18:51:55][                                  Main()] Starting Addon startup function
[11/29/2016 18:51:55][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:51:55][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:51:56][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:51:56][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:51:56][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:52:00][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:52:00][                                  Main()] Creating Event handler class
[11/29/2016 18:52:00][                      Class_Initialize()] Starting function
[11/29/2016 18:52:00][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:52:00][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:52:00][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:52:00][                                  Main()] Calling SetApplication Function
[11/29/2016 18:52:00][                                  Main()] Addon started successfully
[11/29/2016 18:52:01][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:52:11][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:52:14][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:52:17][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:52:17][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:52:17][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:52:17][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:54:12][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 18:54:48][                                  Main()] Starting Addon startup function
[11/29/2016 18:54:48][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:54:48][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:54:48][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:54:48][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:54:48][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:54:52][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:54:52][                                  Main()] Creating Event handler class
[11/29/2016 18:54:52][                      Class_Initialize()] Starting function
[11/29/2016 18:54:52][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:54:52][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:54:52][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:54:52][                                  Main()] Calling SetApplication Function
[11/29/2016 18:54:52][                                  Main()] Addon started successfully
[11/29/2016 18:54:59][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:55:10][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:55:13][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:55:16][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:55:16][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:55:16][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:55:16][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:55:49][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 18:56:14][                                  Main()] Starting Addon startup function
[11/29/2016 18:56:14][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:56:14][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:56:14][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:56:14][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:56:14][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:56:18][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:56:18][                                  Main()] Creating Event handler class
[11/29/2016 18:56:18][                      Class_Initialize()] Starting function
[11/29/2016 18:56:18][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:56:18][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:56:18][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:56:18][                                  Main()] Calling SetApplication Function
[11/29/2016 18:56:18][                                  Main()] Addon started successfully
[11/29/2016 18:56:22][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 18:56:37][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 18:56:44][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 18:56:47][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 18:56:47][             CostAllocation_Validation()] Starting Function
[11/29/2016 18:56:47][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 18:56:47][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 18:57:46][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 18:59:44][                                  Main()] Starting Addon startup function
[11/29/2016 18:59:44][                                  Main()] Initializing public SBO Application object
[11/29/2016 18:59:44][                                  Main()] Retriving SBO application company handle
[11/29/2016 18:59:44][                                  Main()] Retrived SBO application company handle
[11/29/2016 18:59:44][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 18:59:44][                      ConnectDICompSSO()] Starting function
[11/29/2016 18:59:48][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 18:59:48][                                  Main()] Creating Event handler class
[11/29/2016 18:59:48][                      Class_Initialize()] Starting function
[11/29/2016 18:59:48][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 18:59:48][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 18:59:48][                                  Main()] Calling AddMenuItems()
[11/29/2016 18:59:48][                                  Main()] Calling SetApplication Function
[11/29/2016 18:59:48][                                  Main()] Addon started successfully
[11/29/2016 18:59:49][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 19:00:02][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 19:00:05][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 19:00:09][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 19:00:09][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:00:09][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:00:09][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 19:00:30][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 19:17:17][                                  Main()] Starting Addon startup function
[11/29/2016 19:17:17][                                  Main()] Initializing public SBO Application object
[11/29/2016 19:17:17][                                  Main()] Retriving SBO application company handle
[11/29/2016 19:17:17][                                  Main()] Retrived SBO application company handle
[11/29/2016 19:17:17][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 19:17:17][                      ConnectDICompSSO()] Starting function
[11/29/2016 19:17:22][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 19:17:22][                                  Main()] Creating Event handler class
[11/29/2016 19:17:22][                      Class_Initialize()] Starting function
[11/29/2016 19:17:22][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 19:17:22][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 19:17:22][                                  Main()] Calling AddMenuItems()
[11/29/2016 19:17:22][                                  Main()] Calling SetApplication Function
[11/29/2016 19:17:22][                                  Main()] Addon started successfully
[11/29/2016 19:17:26][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 19:17:44][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 19:17:47][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 19:17:57][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 19:17:57][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:17:57][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:18:44][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 19:18:51][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 19:18:56][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 19:19:00][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 19:19:01][             SBO_Application_ItemEvent()] Added 52115
[11/29/2016 19:19:06][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 19:19:06][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:19:06][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:26:26][                                  Main()] Starting Addon startup function
[11/29/2016 19:26:26][                                  Main()] Initializing public SBO Application object
[11/29/2016 19:26:26][                                  Main()] Retriving SBO application company handle
[11/29/2016 19:26:26][                                  Main()] Retrived SBO application company handle
[11/29/2016 19:26:26][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 19:26:26][                      ConnectDICompSSO()] Starting function
[11/29/2016 19:26:31][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 19:26:31][                                  Main()] Creating Event handler class
[11/29/2016 19:26:31][                      Class_Initialize()] Starting function
[11/29/2016 19:26:31][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 19:26:31][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 19:26:31][                                  Main()] Calling AddMenuItems()
[11/29/2016 19:26:31][                                  Main()] Calling SetApplication Function
[11/29/2016 19:26:31][                                  Main()] Addon started successfully
[11/29/2016 19:26:41][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 19:26:41][             SBO_Application_MenuEvent()] Completed with SUCCESS
[11/29/2016 19:26:41][             SBO_Application_MenuEvent()] Starting function
[11/29/2016 19:26:49][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 19:27:11][              Header Show button click()] Calling HeaderValidation()
[11/29/2016 19:27:11][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:27:11][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:27:11][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 19:27:12][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 19:27:19][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 19:27:23][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 19:27:25][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 19:27:25][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:27:25][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:27:25][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 19:27:25][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 19:28:00][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 19:28:04][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 19:28:04][             SBO_Application_ItemEvent()] Added 52115
[11/29/2016 19:28:07][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 19:28:07][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:28:07][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:28:07][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114','52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114','52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 19:28:07][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 19:30:17][                                  Main()] Starting Addon startup function
[11/29/2016 19:30:17][                                  Main()] Initializing public SBO Application object
[11/29/2016 19:30:17][                                  Main()] Retriving SBO application company handle
[11/29/2016 19:30:17][                                  Main()] Retrived SBO application company handle
[11/29/2016 19:30:17][                                  Main()] Calling ConnectDICompSSO()
[11/29/2016 19:30:17][                      ConnectDICompSSO()] Starting function
[11/29/2016 19:30:21][                      ConnectDICompSSO()] Completed with SUCCESS
[11/29/2016 19:30:21][                                  Main()] Creating Event handler class
[11/29/2016 19:30:21][                      Class_Initialize()] Starting function
[11/29/2016 19:30:21][                      Class_Initialize()] Retriving SBO Application handle
[11/29/2016 19:30:21][                      Class_Initialize()] Completed with SUCCESS
[11/29/2016 19:30:21][                                  Main()] Calling AddMenuItems()
[11/29/2016 19:30:21][                                  Main()] Calling SetApplication Function
[11/29/2016 19:30:21][                                  Main()] Addon started successfully
[11/29/2016 19:30:30][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[11/29/2016 19:30:43][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 19:30:46][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 19:30:49][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 19:30:49][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:30:49][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:30:49][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 19:30:49][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[11/29/2016 19:31:06][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[11/29/2016 19:31:09][             SBO_Application_ItemEvent()] Added 52114
[11/29/2016 19:31:10][             SBO_Application_ItemEvent()] Added 52115
[11/29/2016 19:31:11][             SBO_Application_ItemEvent()] Added 52116
[11/29/2016 19:31:12][             SBO_Application_ItemEvent()] Added 52113
[11/29/2016 19:31:15][      Summary Report Show button click()] Calling HeaderValidation()
[11/29/2016 19:31:15][             CostAllocation_Validation()] Starting Function
[11/29/2016 19:31:15][             CostAllocation_Validation()] Completed with SUCCESS
[11/29/2016 19:31:15][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114','52115','52116','52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114','52115','52116','52113')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[11/29/2016 19:31:15][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115','52116','52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115','52116','52113') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115','52116','52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115','52116','52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114','52115','52116','52113')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[12/01/2016 11:29:58][                                  Main()] Starting Addon startup function
[12/01/2016 11:29:58][                                  Main()] Initializing public SBO Application object
[12/01/2016 11:29:58][                                  Main()] Retriving SBO application company handle
[12/01/2016 11:29:59][                                  Main()] Retrived SBO application company handle
[12/01/2016 11:29:59][                                  Main()] Calling ConnectDICompSSO()
[12/01/2016 11:29:59][                      ConnectDICompSSO()] Starting function
[12/01/2016 11:30:03][                      ConnectDICompSSO()] Completed with SUCCESS
[12/01/2016 11:30:03][                                  Main()] Creating Event handler class
[12/01/2016 11:30:03][                      Class_Initialize()] Starting function
[12/01/2016 11:30:03][                      Class_Initialize()] Retriving SBO Application handle
[12/01/2016 11:30:03][                      Class_Initialize()] Completed with SUCCESS
[12/01/2016 11:30:03][                                  Main()] Calling AddMenuItems()
[12/01/2016 11:30:03][                                  Main()] Calling SetApplication Function
[12/01/2016 11:30:03][                                  Main()] Addon started successfully
[12/01/2016 11:30:11][             SBO_Application_MenuEvent()] Starting function
[12/01/2016 11:30:11][             SBO_Application_MenuEvent()] Completed with SUCCESS
[12/01/2016 11:30:11][             SBO_Application_MenuEvent()] Starting function
[12/01/2016 11:30:19][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[12/01/2016 11:30:41][              Header Show button click()] Calling HeaderValidation()
[12/01/2016 11:30:41][             CostAllocation_Validation()] Starting Function
[12/01/2016 11:30:41][             CostAllocation_Validation()] Completed with SUCCESS
[12/01/2016 11:30:41][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[12/01/2016 11:30:41][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[12/01/2016 11:30:53][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[12/01/2016 11:30:59][             SBO_Application_ItemEvent()] Added 52114
[12/01/2016 11:31:03][      Summary Report Show button click()] Calling HeaderValidation()
[12/01/2016 11:31:03][             CostAllocation_Validation()] Starting Function
[12/01/2016 11:31:03][             CostAllocation_Validation()] Completed with SUCCESS
[12/01/2016 11:31:03][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[12/01/2016 11:31:03][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[12/01/2016 11:31:26][              Header Show button click()] Calling HeaderValidation()
[12/01/2016 11:31:26][             CostAllocation_Validation()] Starting Function
[12/01/2016 11:31:26][             CostAllocation_Validation()] Completed with SUCCESS
[12/01/2016 11:31:26][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[12/01/2016 11:31:26][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[12/01/2016 11:31:39][      Summary Report Show button click()] Calling HeaderValidation()
[12/01/2016 11:31:39][             CostAllocation_Validation()] Starting Function
[12/01/2016 11:31:39][             CostAllocation_Validation()] Completed with SUCCESS
[12/01/2016 11:31:39][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''99999999'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[12/01/2016 11:31:39][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '99999999' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[12/01/2016 11:32:00][             SBO_Application_MenuEvent()] Starting function
[12/01/2016 11:32:00][             SBO_Application_MenuEvent()] Completed with SUCCESS
[12/01/2016 11:32:03][             SBO_Application_MenuEvent()] Starting function
[12/01/2016 11:32:03][             SBO_Application_MenuEvent()] Completed with SUCCESS
[12/01/2016 11:32:08][             SBO_Application_MenuEvent()] Starting function
[12/01/2016 11:32:08][             SBO_Application_MenuEvent()] Completed with SUCCESS
[12/01/2016 11:32:08][             SBO_Application_MenuEvent()] Starting function
[12/01/2016 11:32:08][             SBO_Application_MenuEvent()] Completed with SUCCESS
[03/08/2017 13:46:52][                                  Main()] Starting Addon startup function
[03/08/2017 13:46:52][                                  Main()] Initializing public SBO Application object
[03/08/2017 13:46:58][                                  Main()] Retriving SBO application company handle
[03/08/2017 13:47:00][                                  Main()] Retrived SBO application company handle
[03/08/2017 13:47:00][                                  Main()] Calling ConnectDICompSSO()
[03/08/2017 13:47:00][                      ConnectDICompSSO()] Starting function
[04/20/2017 18:23:30][                                  Main()] Starting Addon startup function
[04/20/2017 18:23:30][                                  Main()] Initializing public SBO Application object
[04/20/2017 18:23:30][                                  Main()] Retriving SBO application company handle
[04/20/2017 18:23:31][                                  Main()] Retrived SBO application company handle
[04/20/2017 18:23:31][                                  Main()] Calling ConnectDICompSSO()
[04/20/2017 18:23:31][                      ConnectDICompSSO()] Starting function
[04/20/2017 18:23:35][                      ConnectDICompSSO()] Completed with SUCCESS
[04/20/2017 18:23:35][                                  Main()] Creating Event handler class
[04/20/2017 18:23:35][                      Class_Initialize()] Starting function
[04/20/2017 18:23:35][                      Class_Initialize()] Retriving SBO Application handle
[04/20/2017 18:23:35][                      Class_Initialize()] Completed with SUCCESS
[04/20/2017 18:23:35][                                  Main()] Calling AddMenuItems()
[04/20/2017 18:23:36][                                  Main()] Calling SetApplication Function
[04/20/2017 18:23:36][                                  Main()] Addon started successfully
[04/20/2017 18:23:58][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:23:58][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:23:58][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:24:44][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:24:44][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:24:47][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:24:47][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:24:48][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:24:48][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:24:50][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:24:50][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:25:23][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:25:23][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:25:23][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:25:23][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:25:25][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:25:25][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:25:25][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:25:25][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:25:58][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:25:58][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:25:58][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:25:58][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:00][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:00][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:00][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:00][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:03][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:03][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:03][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:03][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:08][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:08][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:10][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:10][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:11][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:11][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:11][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:11][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:16][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:16][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:16][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:16][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:30][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:30][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:30][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:30][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:39][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:39][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:39][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:39][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:49][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:49][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:26:49][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:26:49][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:01][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:01][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:01][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:01][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:16][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:16][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:16][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:16][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:30][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:30][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:30][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:30][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:56][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:56][             SBO_Application_MenuEvent()] Completed with SUCCESS
[04/20/2017 18:27:57][             SBO_Application_MenuEvent()] Starting function
[04/20/2017 18:27:57][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:28:25][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:28:25][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:28:26][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:28:26][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:28:58][              SBO_Application_AppEvent()] Starting function
[10/20/2016 18:43:52][                                  Main()] Starting Addon startup function
[10/20/2016 18:43:52][                                  Main()] Initializing public SBO Application object
[10/20/2016 18:43:52][                                  Main()] Retriving SBO application company handle
[10/20/2016 18:43:53][                                  Main()] Retrived SBO application company handle
[10/20/2016 18:43:53][                                  Main()] Calling ConnectDICompSSO()
[10/20/2016 18:43:53][                      ConnectDICompSSO()] Starting function
[10/20/2016 18:43:58][                      ConnectDICompSSO()] Completed with SUCCESS
[10/20/2016 18:43:58][                                  Main()] Creating Event handler class
[10/20/2016 18:43:58][                      Class_Initialize()] Starting function
[10/20/2016 18:43:58][                      Class_Initialize()] Retriving SBO Application handle
[10/20/2016 18:43:58][                      Class_Initialize()] Completed with SUCCESS
[10/20/2016 18:43:58][                                  Main()] Calling AddMenuItems()
[10/20/2016 18:43:59][                                  Main()] Calling SetApplication Function
[10/20/2016 18:43:59][                                  Main()] Addon started successfully
[10/20/2016 18:44:16][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:44:17][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:44:17][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:44:39][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[10/20/2016 18:46:07][              Header Show button click()] Calling HeaderValidation()
[10/20/2016 18:46:07][             CostAllocation_Validation()] Starting Function
[10/20/2016 18:46:07][             CostAllocation_Validation()] Completed with SUCCESS
[10/20/2016 18:46:08][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[10/20/2016 18:46:10][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[10/20/2016 18:46:52][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[10/20/2016 18:46:56][             SBO_Application_ItemEvent()] Added 52112
[10/20/2016 18:47:00][      Summary Report Show button click()] Calling HeaderValidation()
[10/20/2016 18:47:00][             CostAllocation_Validation()] Starting Function
[10/20/2016 18:47:00][             CostAllocation_Validation()] Completed with SUCCESS
[10/20/2016 18:47:00][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52112')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52112')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[10/20/2016 18:47:01][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52112') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52112') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52112')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52112')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52112')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[10/20/2016 18:47:29][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:47:30][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:47:30][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:47:30][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:47:32][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:47:32][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:47:32][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:47:32][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:48:26][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:48:27][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:48:27][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:48:27][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:48:41][              Header Show button click()] Calling HeaderValidation()
[10/20/2016 18:48:41][             CostAllocation_Validation()] Starting Function
[10/20/2016 18:48:41][             CostAllocation_Validation()] Completed with SUCCESS
[10/20/2016 18:48:41][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[10/20/2016 18:48:41][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[10/20/2016 18:48:49][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:48:49][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:48:50][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:48:50][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:49:00][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[10/20/2016 18:49:04][             SBO_Application_ItemEvent()] Added 52115
[10/20/2016 18:49:06][      Summary Report Show button click()] Calling HeaderValidation()
[10/20/2016 18:49:07][             CostAllocation_Validation()] Starting Function
[10/20/2016 18:49:07][             CostAllocation_Validation()] Completed with SUCCESS
[10/20/2016 18:49:07][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[10/20/2016 18:49:08][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[10/20/2016 18:51:32][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:51:33][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:51:33][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:51:33][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:52:45][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:52:46][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:52:46][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:52:46][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:52:51][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:52:51][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/20/2016 18:52:51][             SBO_Application_MenuEvent()] Starting function
[10/20/2016 18:52:51][             SBO_Application_MenuEvent()] Completed with SUCCESS
[10/21/2016 01:08:13][                       MAtrixToDataTable] Starting Function
[10/21/2016 01:08:13][           ConvertRecordsetToDataTable()] Starting Fuction 
[10/21/2016 01:08:14][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[10/21/2016 01:08:14][           ConvertRecordsetToDataTable()] Starting Fuction 
[10/21/2016 01:08:14][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[10/21/2016 01:08:14][           ConvertRecordsetToDataTable()] Starting Fuction 
[10/21/2016 01:08:14][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[10/21/2016 01:17:09][                       MAtrixToDataTable] Completed with SUCCESS 
[10/21/2016 01:18:42][             SBO_Application_ItemEvent()] Calling ConnectToTargetCompany()
[10/21/2016 01:18:43][                ConnectToTargetCompany()] Starting function
[10/21/2016 01:18:43][                ConnectToTargetCompany()] Initializing the Company Object
[10/21/2016 01:18:43][                ConnectToTargetCompany()] Assigning the representing database name
[10/21/2016 01:18:43][                ConnectToTargetCompany()] Connecting to the Company Database. IAS7
[10/21/2016 01:18:47][                ConnectToTargetCompany()] Completed with SUCCESS
[10/21/2016 01:18:59][             SBO_Application_ItemEvent()] Starts JV Group 
[10/21/2016 01:19:26][             SBO_Application_ItemEvent()] Starts NON JV Group 
[10/21/2016 01:19:29][             SBO_Application_ItemEvent()] NON JV Group Count 12
[10/21/2016 01:19:40][             SBO_Application_ItemEvent()] Calling JournalEntry_Posting_NONJV_Source()
[10/21/2016 01:20:43][       JournalEntry_Posting_NONJV_Source] Starting Function 
[05/25/2017 17:44:26][                                  Main()] Starting Addon startup function
[05/25/2017 17:44:27][                                  Main()] Initializing public SBO Application object
[05/25/2017 17:44:27][                                  Main()] Retriving SBO application company handle
[05/25/2017 17:44:36][                                  Main()] Retrived SBO application company handle
[05/25/2017 17:44:36][                                  Main()] Calling ConnectDICompSSO()
[05/25/2017 17:44:36][                      ConnectDICompSSO()] Starting function
[05/25/2017 17:44:40][                      ConnectDICompSSO()] Completed with ERROR
[05/25/2017 17:44:40][                                  Main()] Completed with ERROR
[05/25/2017 17:46:00][                                  Main()] Starting Addon startup function
[05/25/2017 17:46:13][                                  Main()] Initializing public SBO Application object
[05/25/2017 17:46:16][                                  Main()] Retriving SBO application company handle
[05/25/2017 17:46:28][                                  Main()] Retrived SBO application company handle
[05/25/2017 17:46:32][                                  Main()] Calling ConnectDICompSSO()
[05/25/2017 17:46:38][                      ConnectDICompSSO()] Starting function
[05/25/2017 17:47:45][                                  Main()] Starting Addon startup function
[05/25/2017 17:47:46][                                  Main()] Initializing public SBO Application object
[05/25/2017 17:47:46][                                  Main()] Retriving SBO application company handle
[05/25/2017 17:47:50][                                  Main()] Retrived SBO application company handle
[05/25/2017 17:47:50][                                  Main()] Calling ConnectDICompSSO()
[05/25/2017 17:47:50][                      ConnectDICompSSO()] Starting function
[05/25/2017 17:52:05][                      ConnectDICompSSO()] Completed with SUCCESS
[05/25/2017 17:52:05][                                  Main()] Creating Event handler class
[05/25/2017 17:52:05][                      Class_Initialize()] Starting function
[05/25/2017 17:52:05][                      Class_Initialize()] Retriving SBO Application handle
[05/25/2017 17:52:05][                      Class_Initialize()] Completed with SUCCESS
[05/25/2017 17:52:05][                                  Main()] Calling AddMenuItems()
[05/25/2017 17:52:07][                                  Main()] Calling SetApplication Function
[05/25/2017 17:52:07][                                  Main()] Addon started successfully
[05/25/2017 17:52:14][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 17:52:14][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 17:52:14][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 17:54:09][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 17:54:09][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 17:54:11][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 17:54:11][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 17:54:20][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 17:54:20][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 17:54:20][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 17:54:20][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 17:54:47][              SBO_Application_AppEvent()] Starting function
[05/25/2017 18:04:05][                                  Main()] Starting Addon startup function
[05/25/2017 18:04:06][                                  Main()] Initializing public SBO Application object
[05/25/2017 18:04:06][                                  Main()] Retriving SBO application company handle
[05/25/2017 18:04:15][                                  Main()] Retrived SBO application company handle
[05/25/2017 18:04:15][                                  Main()] Calling ConnectDICompSSO()
[05/25/2017 18:04:15][                      ConnectDICompSSO()] Starting function
[05/25/2017 18:04:31][                      ConnectDICompSSO()] Completed with SUCCESS
[05/25/2017 18:04:31][                                  Main()] Creating Event handler class
[05/25/2017 18:04:31][                      Class_Initialize()] Starting function
[05/25/2017 18:04:31][                      Class_Initialize()] Retriving SBO Application handle
[05/25/2017 18:04:31][                      Class_Initialize()] Completed with SUCCESS
[05/25/2017 18:04:31][                                  Main()] Calling AddMenuItems()
[05/25/2017 18:04:32][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:04:32][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:04:32][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:04:32][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:04:33][                                  Main()] Calling SetApplication Function
[05/25/2017 18:04:33][                                  Main()] Addon started successfully
[05/25/2017 18:04:41][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:04:41][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:04:41][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:05:01][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/25/2017 18:05:45][              Header Show button click()] Calling HeaderValidation()
[05/25/2017 18:05:45][              Header Show button click()] Completed with ERROR
[05/25/2017 18:08:00][              Header Show button click()] Calling HeaderValidation()
[05/25/2017 18:08:00][              Header Show button click()] Completed with ERROR
[05/25/2017 18:14:48][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:14:48][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:14:48][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:16:25][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:16:25][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:16:25][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:16:50][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/25/2017 18:17:18][              Header Show button click()] Calling HeaderValidation()
[05/25/2017 18:17:19][             CostAllocation_Validation()] Starting Function
[05/25/2017 18:17:19][             CostAllocation_Validation()] Completed with SUCCESS
[05/25/2017 18:17:19][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160701' and  (T1.[ValidTo] >= '20160701' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160701' and  (T1.[ValidTo] >= '20160701' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 7 and month(f.CancelDate) <= 7 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/25/2017 18:17:29][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 7 and month(d.CancelDate) <= 7 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/25/2017 18:18:00][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/25/2017 18:18:06][             SBO_Application_ItemEvent()] Added 52111
[05/25/2017 18:18:09][      Summary Report Show button click()] Calling HeaderValidation()
[05/25/2017 18:18:09][             CostAllocation_Validation()] Starting Function
[05/25/2017 18:18:09][             CostAllocation_Validation()] Completed with SUCCESS
[05/25/2017 18:18:09][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160701' and  (T1.[ValidTo] >= '20160701' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160701' and  (T1.[ValidTo] >= '20160701' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 7 and month(f.CancelDate) <= 7 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160701'' and (e.[ValidTo] >= ''20160701'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/25/2017 18:18:11][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 7 and month(c.refdate) <= 7 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 7 and month(d.CancelDate) <= 7 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160701' and (e1.[ValidTo] >= '20160701' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/25/2017 18:19:28][              Header Show button click()] Calling HeaderValidation()
[05/25/2017 18:19:28][             CostAllocation_Validation()] Starting Function
[05/25/2017 18:19:28][             CostAllocation_Validation()] Completed with SUCCESS
[05/25/2017 18:19:28][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/25/2017 18:19:30][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/25/2017 18:19:47][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/25/2017 18:19:52][             SBO_Application_ItemEvent()] Added 52115
[05/25/2017 18:19:56][      Summary Report Show button click()] Calling HeaderValidation()
[05/25/2017 18:19:56][             CostAllocation_Validation()] Starting Function
[05/25/2017 18:19:56][             CostAllocation_Validation()] Completed with SUCCESS
[05/25/2017 18:19:56][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/25/2017 18:19:57][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/25/2017 18:20:21][                       MAtrixToDataTable] Starting Function
[05/25/2017 18:20:21][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/25/2017 18:20:22][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/25/2017 18:20:22][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/25/2017 18:20:24][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/25/2017 18:20:24][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/25/2017 18:20:24][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/25/2017 18:21:09][                        Write_TextFile()] Starting Function 
[05/25/2017 18:21:09][                        Write_TextFile()] Completed With SUCCESS 
[05/25/2017 18:21:09][             SBO_Application_ItemEvent()] Completed with ERROR
[05/25/2017 18:21:37][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:37][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:21:38][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:38][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:21:40][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:40][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:21:40][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:40][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:21:41][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:41][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:21:41][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:41][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:21:57][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:57][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:21:58][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:21:58][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:22:53][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:22:53][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:22:53][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:22:53][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:23:05][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:23:05][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:23:05][             SBO_Application_MenuEvent()] Starting function
[05/25/2017 18:23:05][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/25/2017 18:23:26][                       MAtrixToDataTable] Starting Function
[05/25/2017 18:23:51][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/25/2017 18:23:52][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 09:49:03][                                  Main()] Starting Addon startup function
[05/26/2017 09:49:04][                                  Main()] Initializing public SBO Application object
[05/26/2017 09:49:04][                                  Main()] Retriving SBO application company handle
[05/26/2017 09:49:07][                                  Main()] Retrived SBO application company handle
[05/26/2017 09:49:07][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 09:49:07][                      ConnectDICompSSO()] Starting function
[05/26/2017 09:49:22][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 09:49:22][                                  Main()] Creating Event handler class
[05/26/2017 09:49:22][                      Class_Initialize()] Starting function
[05/26/2017 09:49:22][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 09:49:22][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 09:49:22][                                  Main()] Calling AddMenuItems()
[05/26/2017 09:49:24][                                  Main()] Calling SetApplication Function
[05/26/2017 09:49:24][                                  Main()] Addon started successfully
[05/26/2017 09:49:33][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 09:49:33][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 09:49:33][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 09:50:04][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 09:50:18][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 09:50:19][             CostAllocation_Validation()] Starting Function
[05/26/2017 09:50:19][      Summary Report Show button click()] Completed with ERROR
[05/26/2017 09:50:34][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 09:50:34][             CostAllocation_Validation()] Starting Function
[05/26/2017 09:50:34][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 09:50:34][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 09:50:35][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 09:52:25][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 09:52:25][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 09:52:25][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 09:52:25][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 09:54:17][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 09:54:17][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 09:54:17][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 09:55:44][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 09:56:11][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 09:56:11][             CostAllocation_Validation()] Starting Function
[05/26/2017 09:56:11][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 09:56:12][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20170801' and  (T1.[ValidTo] >= '20170801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20170801' and  (T1.[ValidTo] >= '20170801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e.[ValidFrom] <= ''20170801'' and (e.[ValidTo] >= ''20170801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e.[ValidFrom] <= ''20170801'' and (e.[ValidTo] >= ''20170801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e.[ValidFrom] <= ''20170801'' and (e.[ValidTo] >= ''20170801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e.[ValidFrom] <= ''20170801'' and (e.[ValidTo] >= ''20170801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2017  and  e.[ValidFrom] <= ''20170801'' and (e.[ValidTo] >= ''20170801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 09:56:13][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e1.[ValidFrom] <= '20170801' and (e1.[ValidTo] >= '20170801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e1.[ValidFrom] <= '20170801' and (e1.[ValidTo] >= '20170801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e1.[ValidFrom] <= '20170801' and (e1.[ValidTo] >= '20170801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2017  and  e1.[ValidFrom] <= '20170801' and (e1.[ValidTo] >= '20170801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2017  and  e1.[ValidFrom] <= '20170801' and (e1.[ValidTo] >= '20170801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 09:56:26][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 09:56:26][             CostAllocation_Validation()] Starting Function
[05/26/2017 09:56:26][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 09:56:27][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 09:56:27][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 09:56:34][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 09:56:52][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 09:56:58][             SBO_Application_ItemEvent()] Added 52114
[05/26/2017 09:57:03][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 09:57:03][             CostAllocation_Validation()] Starting Function
[05/26/2017 09:57:03][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 09:57:03][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52114')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 09:57:04][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52114')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 09:57:19][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 09:57:19][             CostAllocation_Validation()] Starting Function
[05/26/2017 09:57:19][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 09:57:19][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 09:57:20][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 09:57:33][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 09:57:37][             SBO_Application_ItemEvent()] Added 52115
[05/26/2017 09:57:41][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 09:57:41][             CostAllocation_Validation()] Starting Function
[05/26/2017 09:57:41][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 09:57:41][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 09:57:42][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 09:57:59][                       MAtrixToDataTable] Starting Function
[05/26/2017 09:57:59][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 09:58:00][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 09:58:00][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 09:58:01][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 09:58:01][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 09:58:01][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 09:58:05][                       MAtrixToDataTable] Completed with SUCCESS 
[05/26/2017 09:58:05][             SBO_Application_ItemEvent()] Calling ConnectToTargetCompany()
[05/26/2017 09:58:05][                ConnectToTargetCompany()] Starting function
[05/26/2017 09:58:05][                ConnectToTargetCompany()] Initializing the Company Object
[05/26/2017 09:58:05][                ConnectToTargetCompany()] Assigning the representing database name
[05/26/2017 09:58:05][                ConnectToTargetCompany()] Connecting to the Company Database. IAS7
[05/26/2017 09:58:09][                ConnectToTargetCompany()] Completed with ERROR
[05/26/2017 09:58:09][             SBO_Application_ItemEvent()] Completed with ERROR
[05/26/2017 12:04:52][                                  Main()] Starting Addon startup function
[05/26/2017 12:04:53][                                  Main()] Initializing public SBO Application object
[05/26/2017 12:04:53][                                  Main()] Retriving SBO application company handle
[05/26/2017 12:04:57][                                  Main()] Retrived SBO application company handle
[05/26/2017 12:04:57][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 12:04:57][                      ConnectDICompSSO()] Starting function
[05/26/2017 12:05:12][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 12:05:12][                                  Main()] Creating Event handler class
[05/26/2017 12:05:12][                      Class_Initialize()] Starting function
[05/26/2017 12:05:12][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 12:05:12][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 12:05:12][                                  Main()] Calling AddMenuItems()
[05/26/2017 12:05:12][                                  Main()] Calling SetApplication Function
[05/26/2017 12:05:12][                                  Main()] Addon started successfully
[05/26/2017 12:05:56][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 12:05:56][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 12:05:56][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 12:06:09][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 12:06:38][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 12:06:38][             CostAllocation_Validation()] Starting Function
[05/26/2017 12:06:38][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 12:06:38][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 12:06:40][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 12:06:49][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 12:06:56][             SBO_Application_ItemEvent()] Added 52115
[05/26/2017 12:07:00][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 12:07:00][             CostAllocation_Validation()] Starting Function
[05/26/2017 12:07:00][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 12:07:00][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91111000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 12:07:01][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91111000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 12:07:32][                       MAtrixToDataTable] Starting Function
[05/26/2017 12:07:32][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 12:07:32][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 12:07:32][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 12:07:33][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 12:07:33][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 12:07:34][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 12:07:39][                       MAtrixToDataTable] Completed with SUCCESS 
[05/26/2017 12:24:04][                                  Main()] Starting Addon startup function
[05/26/2017 12:24:05][                                  Main()] Initializing public SBO Application object
[05/26/2017 12:24:05][                                  Main()] Retriving SBO application company handle
[05/26/2017 12:24:08][                                  Main()] Retrived SBO application company handle
[05/26/2017 12:24:08][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 12:24:08][                      ConnectDICompSSO()] Starting function
[05/26/2017 12:24:22][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 12:24:22][                                  Main()] Creating Event handler class
[05/26/2017 12:24:22][                      Class_Initialize()] Starting function
[05/26/2017 12:24:22][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 12:24:22][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 12:24:22][                                  Main()] Calling AddMenuItems()
[05/26/2017 12:24:22][                                  Main()] Calling SetApplication Function
[05/26/2017 12:24:22][                                  Main()] Addon started successfully
[05/26/2017 12:24:35][                       MAtrixToDataTable] Starting Function
[05/26/2017 12:24:35][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 12:24:36][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 12:24:36][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 12:24:37][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 12:24:37][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 12:24:38][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 12:24:44][                       MAtrixToDataTable] Completed with SUCCESS 
[05/26/2017 13:31:45][                                  Main()] Starting Addon startup function
[05/26/2017 13:31:46][                                  Main()] Initializing public SBO Application object
[05/26/2017 13:31:46][                                  Main()] Retriving SBO application company handle
[05/26/2017 13:31:49][                                  Main()] Retrived SBO application company handle
[05/26/2017 13:31:49][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 13:31:49][                      ConnectDICompSSO()] Starting function
[05/26/2017 13:32:13][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 13:32:13][                                  Main()] Creating Event handler class
[05/26/2017 13:32:13][                      Class_Initialize()] Starting function
[05/26/2017 13:32:13][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 13:32:13][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 13:32:13][                                  Main()] Calling AddMenuItems()
[05/26/2017 13:32:14][                                  Main()] Calling SetApplication Function
[05/26/2017 13:32:14][                                  Main()] Addon started successfully
[05/26/2017 13:32:17][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 13:32:17][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 13:32:17][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 13:32:36][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 13:33:18][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 13:33:24][             SBO_Application_ItemEvent()] Added 52100
[05/26/2017 13:33:32][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 13:33:32][             CostAllocation_Validation()] Starting Function
[05/26/2017 13:33:32][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 13:33:32][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52100')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52100')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 13:33:32][      Summary Report Show button click()] Completed with ERROR
[05/26/2017 13:33:35][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 13:33:35][             CostAllocation_Validation()] Starting Function
[05/26/2017 13:33:35][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 13:33:35][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 13:33:37][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 13:33:56][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 13:33:56][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 13:33:56][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 13:33:56][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 13:34:17][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 13:34:24][             SBO_Application_ItemEvent()] Added 52120
[05/26/2017 13:34:28][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 13:34:28][             CostAllocation_Validation()] Starting Function
[05/26/2017 13:34:28][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 13:34:28][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52120')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52120')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 13:34:29][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 13:34:42][                       MAtrixToDataTable] Starting Function
[05/26/2017 13:34:42][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 13:34:42][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 13:34:42][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 13:34:43][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 13:34:43][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 13:34:44][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 13:57:42][                                  Main()] Starting Addon startup function
[05/26/2017 13:57:43][                                  Main()] Initializing public SBO Application object
[05/26/2017 13:57:43][                                  Main()] Retriving SBO application company handle
[05/26/2017 13:57:46][                                  Main()] Retrived SBO application company handle
[05/26/2017 13:57:46][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 13:57:46][                      ConnectDICompSSO()] Starting function
[05/26/2017 13:58:01][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 13:58:01][                                  Main()] Creating Event handler class
[05/26/2017 13:58:01][                      Class_Initialize()] Starting function
[05/26/2017 13:58:01][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 13:58:01][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 13:58:01][                                  Main()] Calling AddMenuItems()
[05/26/2017 13:58:01][                                  Main()] Calling SetApplication Function
[05/26/2017 13:58:01][                                  Main()] Addon started successfully
[05/26/2017 13:58:28][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 13:58:28][             CostAllocation_Validation()] Starting Function
[05/26/2017 13:58:45][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 13:59:00][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 13:59:07][             SBO_Application_ItemEvent()] Added 52120
[05/26/2017 13:59:10][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 13:59:10][             CostAllocation_Validation()] Starting Function
[05/26/2017 13:59:10][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 13:59:11][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52120')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52120')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 13:59:11][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52120')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 13:59:29][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 13:59:29][             CostAllocation_Validation()] Starting Function
[05/26/2017 13:59:30][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 14:00:11][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 14:00:12][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 14:00:35][                          PrintCalling()] Starting function
[05/26/2017 15:35:09][                                  Main()] Starting Addon startup function
[05/26/2017 15:35:10][                                  Main()] Initializing public SBO Application object
[05/26/2017 15:35:11][                                  Main()] Retriving SBO application company handle
[05/26/2017 15:35:14][                                  Main()] Retrived SBO application company handle
[05/26/2017 15:35:14][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 15:35:14][                      ConnectDICompSSO()] Starting function
[05/26/2017 15:35:32][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 15:35:32][                                  Main()] Creating Event handler class
[05/26/2017 15:35:32][                      Class_Initialize()] Starting function
[05/26/2017 15:35:32][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 15:35:32][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 15:35:32][                                  Main()] Calling AddMenuItems()
[05/26/2017 15:35:32][                                  Main()] Calling SetApplication Function
[05/26/2017 15:35:32][                                  Main()] Addon started successfully
[05/26/2017 15:35:34][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 15:35:34][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 15:35:34][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 15:35:48][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 15:36:14][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 15:36:15][             CostAllocation_Validation()] Starting Function
[05/26/2017 15:36:15][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 15:36:15][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 15:36:15][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 15:36:20][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 15:36:24][             SBO_Application_ItemEvent()] Added 52111
[05/26/2017 15:36:28][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 15:36:28][             CostAllocation_Validation()] Starting Function
[05/26/2017 15:36:28][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 15:36:28][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 15:36:31][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 15:36:38][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 15:36:38][             CostAllocation_Validation()] Starting Function
[05/26/2017 15:36:39][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 15:36:41][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 15:36:41][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 15:36:41][                          PrintCalling()] Starting function
[05/26/2017 15:36:44][                          PrintCalling()] Loading Layout 
[05/26/2017 15:36:50][                          PrintCalling()] Assinging DS to Layout
[05/26/2017 15:36:51][                          PrintCalling()] Starting Printing
[05/26/2017 15:36:51][                          PrintCalling()] Default Printer name Microsoft XPS Document Writer
[05/26/2017 15:37:01][                          PrintCalling()] Completed with SUCCESS
[05/26/2017 15:59:56][              Header Show button click()] Calling HeaderValidation()
[05/26/2017 15:59:56][             CostAllocation_Validation()] Starting Function
[05/26/2017 15:59:56][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 15:59:56][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 15:59:57][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 16:00:13][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 16:00:13][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 16:00:14][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 16:00:14][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 16:00:16][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 16:00:16][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 16:00:16][             SBO_Application_MenuEvent()] Starting function
[05/26/2017 16:00:16][             SBO_Application_MenuEvent()] Completed with SUCCESS
[05/26/2017 16:00:38][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 16:00:44][             SBO_Application_ItemEvent()] Added 52115
[05/26/2017 16:00:48][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 16:00:48][             CostAllocation_Validation()] Starting Function
[05/26/2017 16:00:48][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 16:00:48][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 16:00:50][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 16:00:57][                       MAtrixToDataTable] Starting Function
[05/26/2017 16:00:57][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:00:58][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:00:58][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:00:58][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:00:58][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:00:59][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:00:59][             SBO_Application_ItemEvent()] Completed with ERROR
[05/26/2017 16:02:58][                       MAtrixToDataTable] Starting Function
[05/26/2017 16:02:59][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:02:59][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:02:59][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:03:00][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:03:00][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:03:01][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:03:31][             SBO_Application_ItemEvent()] Completed with ERROR
[05/26/2017 16:10:08][                                  Main()] Starting Addon startup function
[05/26/2017 16:10:09][                                  Main()] Initializing public SBO Application object
[05/26/2017 16:10:09][                                  Main()] Retriving SBO application company handle
[05/26/2017 16:10:14][                                  Main()] Retrived SBO application company handle
[05/26/2017 16:10:14][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 16:10:14][                      ConnectDICompSSO()] Starting function
[05/26/2017 16:10:34][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 16:10:34][                                  Main()] Creating Event handler class
[05/26/2017 16:10:34][                      Class_Initialize()] Starting function
[05/26/2017 16:10:34][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 16:10:34][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 16:10:34][                                  Main()] Calling AddMenuItems()
[05/26/2017 16:10:34][                                  Main()] Calling SetApplication Function
[05/26/2017 16:10:34][                                  Main()] Addon started successfully
[05/26/2017 16:10:38][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 16:11:00][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 16:11:26][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 16:11:31][             SBO_Application_ItemEvent()] Added 52115
[05/26/2017 16:11:36][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 16:11:36][             CostAllocation_Validation()] Starting Function
[05/26/2017 16:11:37][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 16:11:37][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 16:11:38][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 16:11:47][                       MAtrixToDataTable] Starting Function
[05/26/2017 16:11:47][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode], T0.[PrcName], T0.[U_AB_ENTITY], T1.[AcctCode], T1.[AcctName] FROM OPRC T0 join OACT T1 on T1.Details  like '%' + T0.U_AB_ENTITY + '%' WHERE T0.[DimCode] = 3
[05/26/2017 16:11:47][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:11:48][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:11:48][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode] 'OU' , T0.[U_AB_REPORTCODE] 'BU' , T1.[U_AB_REPORTCODE] 'LOS' FROM OPRC T0 left outer join  OPRC T1 on T0.U_AB_REPORTCODE =  T1.PrcCode
[05/26/2017 16:11:48][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:11:49][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:11:49][                       MAtrixToDataTable] SQL SELECT T0.[U_AB_USERCODE], T0.[U_AB_PASSWORD], T0.[U_AB_COMCODE], T0.[U_AB_COMPANYNAME], T0.[U_AB_GROUP], T0.[U_AB_JVCREDIT] , T0.[U_AB_JVDEBIT], T0.[U_AB_NONJVCREDIT], T0.[U_AB_DEPACC], T0.[U_AB_DEPALLACC] FROM [dbo].[@AB_COMPANYDATA]  T0
[05/26/2017 16:11:49][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:11:49][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:11:49][                       MAtrixToDataTable] 1
[05/26/2017 16:11:49][                       MAtrixToDataTable] 2
[05/26/2017 16:11:49][                       MAtrixToDataTable] 3
[05/26/2017 16:11:49][                       MAtrixToDataTable] 5
[05/26/2017 16:11:49][                       MAtrixToDataTable] 61
[05/26/2017 16:11:49][                       MAtrixToDataTable] 7PWCL
[05/26/2017 16:11:49][                       MAtrixToDataTable] 8
[05/26/2017 16:12:28][             SBO_Application_ItemEvent()] Completed with ERROR
[05/26/2017 16:13:01][                       MAtrixToDataTable] Starting Function
[05/26/2017 16:13:10][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode], T0.[PrcName], T0.[U_AB_ENTITY], T1.[AcctCode], T1.[AcctName] FROM OPRC T0 join OACT T1 on T1.Details  like '%' + T0.U_AB_ENTITY + '%' WHERE T0.[DimCode] = 3
[05/26/2017 16:13:10][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:13:11][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:13:14][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode] 'OU' , T0.[U_AB_REPORTCODE] 'BU' , T1.[U_AB_REPORTCODE] 'LOS' FROM OPRC T0 left outer join  OPRC T1 on T0.U_AB_REPORTCODE =  T1.PrcCode
[05/26/2017 16:13:15][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:13:17][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:13:19][                       MAtrixToDataTable] SQL SELECT T0.[U_AB_USERCODE], T0.[U_AB_PASSWORD], T0.[U_AB_COMCODE], T0.[U_AB_COMPANYNAME], T0.[U_AB_GROUP], T0.[U_AB_JVCREDIT] , T0.[U_AB_JVDEBIT], T0.[U_AB_NONJVCREDIT], T0.[U_AB_DEPACC], T0.[U_AB_DEPALLACC] FROM [dbo].[@AB_COMPANYDATA]  T0
[05/26/2017 16:13:19][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:13:20][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:13:20][                       MAtrixToDataTable] 1
[05/26/2017 16:13:21][                       MAtrixToDataTable] 2
[05/26/2017 16:13:23][                       MAtrixToDataTable] 3
[05/26/2017 16:13:32][                       MAtrixToDataTable] 5
[05/26/2017 16:13:37][                       MAtrixToDataTable] 61
[05/26/2017 16:13:40][                       MAtrixToDataTable] 7PWCL
[05/26/2017 16:13:43][                       MAtrixToDataTable] 8
[05/26/2017 16:17:36][                                  Main()] Starting Addon startup function
[05/26/2017 16:17:37][                                  Main()] Initializing public SBO Application object
[05/26/2017 16:17:37][                                  Main()] Retriving SBO application company handle
[05/26/2017 16:17:41][                                  Main()] Retrived SBO application company handle
[05/26/2017 16:17:41][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 16:17:41][                      ConnectDICompSSO()] Starting function
[05/26/2017 16:17:54][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 16:17:54][                                  Main()] Creating Event handler class
[05/26/2017 16:17:54][                      Class_Initialize()] Starting function
[05/26/2017 16:17:54][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 16:17:54][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 16:17:54][                                  Main()] Calling AddMenuItems()
[05/26/2017 16:17:55][                                  Main()] Calling SetApplication Function
[05/26/2017 16:17:55][                                  Main()] Addon started successfully
[05/26/2017 16:18:02][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 16:18:18][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 16:18:22][             SBO_Application_ItemEvent()] Added 52115
[05/26/2017 16:18:34][                       MAtrixToDataTable] Starting Function
[05/26/2017 16:18:34][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode], T0.[PrcName], T0.[U_AB_ENTITY], T1.[AcctCode], T1.[AcctName] FROM OPRC T0 join OACT T1 on T1.Details  like '%' + T0.U_AB_ENTITY + '%' WHERE T0.[DimCode] = 3
[05/26/2017 16:18:34][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:18:35][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:18:35][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode] 'OU' , T0.[U_AB_REPORTCODE] 'BU' , T1.[U_AB_REPORTCODE] 'LOS' FROM OPRC T0 left outer join  OPRC T1 on T0.U_AB_REPORTCODE =  T1.PrcCode
[05/26/2017 16:18:35][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:18:37][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:18:37][                       MAtrixToDataTable] SQL SELECT T0.[U_AB_USERCODE], T0.[U_AB_PASSWORD], T0.[U_AB_COMCODE], T0.[U_AB_COMPANYNAME], T0.[U_AB_GROUP], T0.[U_AB_JVCREDIT] , T0.[U_AB_JVDEBIT], T0.[U_AB_NONJVCREDIT], T0.[U_AB_DEPACC], T0.[U_AB_DEPALLACC] FROM [dbo].[@AB_COMPANYDATA]  T0
[05/26/2017 16:18:37][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:18:37][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:18:37][                       MAtrixToDataTable] 1
[05/26/2017 16:18:37][                       MAtrixToDataTable] 2
[05/26/2017 16:18:37][                       MAtrixToDataTable] 3
[05/26/2017 16:18:37][                       MAtrixToDataTable] 5
[05/26/2017 16:18:37][                       MAtrixToDataTable] 61
[05/26/2017 16:18:37][                       MAtrixToDataTable] 7PWCL
[05/26/2017 16:18:37][                       MAtrixToDataTable] 8
[05/26/2017 16:21:09][                                  Main()] Starting Addon startup function
[05/26/2017 16:21:10][                                  Main()] Initializing public SBO Application object
[05/26/2017 16:21:10][                                  Main()] Retriving SBO application company handle
[05/26/2017 16:21:14][                                  Main()] Retrived SBO application company handle
[05/26/2017 16:21:14][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 16:21:14][                      ConnectDICompSSO()] Starting function
[05/26/2017 16:21:29][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 16:21:29][                                  Main()] Creating Event handler class
[05/26/2017 16:21:29][                      Class_Initialize()] Starting function
[05/26/2017 16:21:29][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 16:21:29][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 16:21:29][                                  Main()] Calling AddMenuItems()
[05/26/2017 16:21:29][                                  Main()] Calling SetApplication Function
[05/26/2017 16:21:29][                                  Main()] Addon started successfully
[05/26/2017 16:21:34][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 16:21:54][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 16:21:59][             SBO_Application_ItemEvent()] Added 52115
[05/26/2017 16:26:59][                                  Main()] Starting Addon startup function
[05/26/2017 16:27:00][                                  Main()] Initializing public SBO Application object
[05/26/2017 16:27:00][                                  Main()] Retriving SBO application company handle
[05/26/2017 16:27:05][                                  Main()] Retrived SBO application company handle
[05/26/2017 16:27:05][                                  Main()] Calling ConnectDICompSSO()
[05/26/2017 16:27:05][                      ConnectDICompSSO()] Starting function
[05/26/2017 16:27:20][                      ConnectDICompSSO()] Completed with SUCCESS
[05/26/2017 16:27:20][                                  Main()] Creating Event handler class
[05/26/2017 16:27:20][                      Class_Initialize()] Starting function
[05/26/2017 16:27:20][                      Class_Initialize()] Retriving SBO Application handle
[05/26/2017 16:27:20][                      Class_Initialize()] Completed with SUCCESS
[05/26/2017 16:27:20][                                  Main()] Calling AddMenuItems()
[05/26/2017 16:27:20][                                  Main()] Calling SetApplication Function
[05/26/2017 16:27:20][                                  Main()] Addon started successfully
[05/26/2017 16:27:26][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[05/26/2017 16:27:44][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[05/26/2017 16:27:49][             SBO_Application_ItemEvent()] Added 52115
[05/26/2017 16:27:52][      Summary Report Show button click()] Calling HeaderValidation()
[05/26/2017 16:27:52][             CostAllocation_Validation()] Starting Function
[05/26/2017 16:27:52][             CostAllocation_Validation()] Completed with SUCCESS
[05/26/2017 16:27:52][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160801' and  (T1.[ValidTo] >= '20160801' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52115')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''71101000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 8 and month(f.CancelDate) <= 8 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160801'' and (e.[ValidTo] >= ''20160801'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[05/26/2017 16:27:53][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 8 and month(c.refdate) <= 8 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '71101000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 8 and month(d.CancelDate) <= 8 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160801' and (e1.[ValidTo] >= '20160801' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52115')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[05/26/2017 16:27:58][                       MAtrixToDataTable] Starting Function
[05/26/2017 16:27:58][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode], T0.[PrcName], T0.[U_AB_ENTITY], T1.[AcctCode], T1.[AcctName] FROM OPRC T0 join OACT T1 on T1.Details  like '%' + T0.U_AB_ENTITY + '%' WHERE T0.[DimCode] = 3
[05/26/2017 16:27:58][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:27:59][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:27:59][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode] 'OU' , T0.[U_AB_REPORTCODE] 'BU' , T1.[U_AB_REPORTCODE] 'LOS' FROM OPRC T0 left outer join  OPRC T1 on T0.U_AB_REPORTCODE =  T1.PrcCode
[05/26/2017 16:27:59][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:28:00][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:28:00][                       MAtrixToDataTable] SQL SELECT T0.[U_AB_USERCODE], T0.[U_AB_PASSWORD], T0.[U_AB_COMCODE], T0.[U_AB_COMPANYNAME], T0.[U_AB_GROUP], T0.[U_AB_JVCREDIT] , T0.[U_AB_JVDEBIT], T0.[U_AB_NONJVCREDIT], T0.[U_AB_DEPACC], T0.[U_AB_DEPALLACC] FROM [dbo].[@AB_COMPANYDATA]  T0
[05/26/2017 16:28:00][           ConvertRecordsetToDataTable()] Starting Fuction 
[05/26/2017 16:28:00][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[05/26/2017 16:28:00][                       MAtrixToDataTable] 1
[05/26/2017 16:28:00][                       MAtrixToDataTable] 2
[05/26/2017 16:28:00][                       MAtrixToDataTable] 3
[05/26/2017 16:28:00][                       MAtrixToDataTable] 5
[05/26/2017 16:28:00][                       MAtrixToDataTable] 61
[05/26/2017 16:28:00][                       MAtrixToDataTable] 7PWCL
[05/26/2017 16:28:00][                       MAtrixToDataTable] 8
[05/26/2017 16:28:01][             SBO_Application_ItemEvent()] Completed with ERROR
[06/13/2017 10:49:21][                                  Main()] Starting Addon startup function
[06/13/2017 10:49:22][                                  Main()] Initializing public SBO Application object
[06/13/2017 10:49:22][                                  Main()] Retriving SBO application company handle
[06/13/2017 10:49:33][                                  Main()] Retrived SBO application company handle
[06/13/2017 10:49:33][                                  Main()] Calling ConnectDICompSSO()
[06/13/2017 10:49:33][                      ConnectDICompSSO()] Starting function
[06/13/2017 10:50:16][                      ConnectDICompSSO()] Completed with SUCCESS
[06/13/2017 10:50:16][                                  Main()] Creating Event handler class
[06/13/2017 10:50:17][                      Class_Initialize()] Starting function
[06/13/2017 10:50:17][                      Class_Initialize()] Retriving SBO Application handle
[06/13/2017 10:50:17][                      Class_Initialize()] Completed with SUCCESS
[06/13/2017 10:50:17][                                  Main()] Calling AddMenuItems()
[06/13/2017 10:50:23][                                  Main()] Calling SetApplication Function
[06/13/2017 10:50:23][                                  Main()] Addon started successfully
[06/13/2017 10:51:52][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 10:51:52][             SBO_Application_MenuEvent()] Completed with SUCCESS
[06/13/2017 10:51:52][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 10:52:17][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[06/13/2017 10:52:48][              Header Show button click()] Calling HeaderValidation()
[06/13/2017 10:52:48][             CostAllocation_Validation()] Starting Function
[06/13/2017 10:52:48][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 10:52:48][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 10:52:53][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 10:53:05][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[06/13/2017 10:53:10][             SBO_Application_ItemEvent()] Added 52111
[06/13/2017 10:53:14][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 10:53:14][             CostAllocation_Validation()] Starting Function
[06/13/2017 10:53:14][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 10:53:14][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 10:53:15][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 10:53:30][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 10:53:30][             CostAllocation_Validation()] Starting Function
[06/13/2017 10:53:30][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 10:53:32][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 10:53:32][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 10:53:32][                          PrintCalling()] Starting function
[06/13/2017 10:53:34][                          PrintCalling()] Loading Layout 
[06/13/2017 10:53:39][                          PrintCalling()] Assinging DS to Layout
[06/13/2017 10:53:40][                          PrintCalling()] Starting Printing
[06/13/2017 10:53:40][                          PrintCalling()] Default Printer name Microsoft XPS Document Writer
[06/13/2017 10:53:49][                          PrintCalling()] Completed with SUCCESS
[06/13/2017 10:53:55][                       MAtrixToDataTable] Starting Function
[06/13/2017 10:53:55][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 10:53:55][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 10:53:55][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 10:53:56][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 10:54:14][                        Write_TextFile()] Starting Function 
[06/13/2017 10:54:14][                        Write_TextFile()] Completed With SUCCESS 
[06/13/2017 10:54:14][                          PrintCalling()] Starting function
[06/13/2017 10:54:14][                          PrintCalling()] Loading Layout 
[06/13/2017 10:54:15][                          PrintCalling()] Assigning DS to Layout 
[06/13/2017 10:54:30][                       MAtrixToDataTable] Starting Function
[06/13/2017 10:54:31][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 10:54:31][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 10:54:31][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 10:54:31][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 10:54:33][                        Write_TextFile()] Starting Function 
[06/13/2017 10:54:33][                        Write_TextFile()] Completed With SUCCESS 
[06/13/2017 10:54:33][                          PrintCalling()] Starting function
[06/13/2017 10:54:33][                          PrintCalling()] Loading Layout 
[06/13/2017 10:54:34][                          PrintCalling()] Assigning DS to Layout 
[06/13/2017 10:55:12][                       MAtrixToDataTable] Starting Function
[06/13/2017 10:55:12][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 10:55:12][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 10:55:13][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 10:55:13][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 10:55:15][                        Write_TextFile()] Starting Function 
[06/13/2017 10:55:15][                        Write_TextFile()] Completed With SUCCESS 
[06/13/2017 10:55:15][                          PrintCalling()] Starting function
[06/13/2017 10:55:15][                          PrintCalling()] Loading Layout 
[06/13/2017 10:55:16][                          PrintCalling()] Assigning DS to Layout 
[06/13/2017 10:56:00][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 10:56:00][             SBO_Application_MenuEvent()] Completed with SUCCESS
[06/13/2017 10:56:00][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 10:56:00][             SBO_Application_MenuEvent()] Completed with SUCCESS
[06/13/2017 11:01:43][                                  Main()] Starting Addon startup function
[06/13/2017 11:01:44][                                  Main()] Initializing public SBO Application object
[06/13/2017 11:01:44][                                  Main()] Retriving SBO application company handle
[06/13/2017 11:01:48][                                  Main()] Retrived SBO application company handle
[06/13/2017 11:01:48][                                  Main()] Calling ConnectDICompSSO()
[06/13/2017 11:01:48][                      ConnectDICompSSO()] Starting function
[06/13/2017 11:02:01][                      ConnectDICompSSO()] Completed with SUCCESS
[06/13/2017 11:02:01][                                  Main()] Creating Event handler class
[06/13/2017 11:02:01][                      Class_Initialize()] Starting function
[06/13/2017 11:02:01][                      Class_Initialize()] Retriving SBO Application handle
[06/13/2017 11:02:01][                      Class_Initialize()] Completed with SUCCESS
[06/13/2017 11:02:01][                                  Main()] Calling AddMenuItems()
[06/13/2017 11:02:01][                                  Main()] Calling SetApplication Function
[06/13/2017 11:02:01][                                  Main()] Addon started successfully
[06/13/2017 11:02:48][                                  Main()] Starting Addon startup function
[06/13/2017 11:02:49][                                  Main()] Initializing public SBO Application object
[06/13/2017 11:02:49][                                  Main()] Retriving SBO application company handle
[06/13/2017 11:02:53][                                  Main()] Retrived SBO application company handle
[06/13/2017 11:02:53][                                  Main()] Calling ConnectDICompSSO()
[06/13/2017 11:02:53][                      ConnectDICompSSO()] Starting function
[06/13/2017 11:03:06][                      ConnectDICompSSO()] Completed with SUCCESS
[06/13/2017 11:03:06][                                  Main()] Creating Event handler class
[06/13/2017 11:03:06][                      Class_Initialize()] Starting function
[06/13/2017 11:03:06][                      Class_Initialize()] Retriving SBO Application handle
[06/13/2017 11:03:06][                      Class_Initialize()] Completed with SUCCESS
[06/13/2017 11:03:06][                                  Main()] Calling AddMenuItems()
[06/13/2017 11:03:06][                                  Main()] Calling SetApplication Function
[06/13/2017 11:03:06][                                  Main()] Addon started successfully
[06/13/2017 11:03:15][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 11:03:15][             SBO_Application_MenuEvent()] Completed with SUCCESS
[06/13/2017 11:03:15][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 11:03:28][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[06/13/2017 11:04:04][              Header Show button click()] Calling HeaderValidation()
[06/13/2017 11:04:05][             CostAllocation_Validation()] Starting Function
[06/13/2017 11:04:05][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 11:04:05][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 11:04:06][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 11:04:10][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[06/13/2017 11:04:14][             SBO_Application_ItemEvent()] Added 52111
[06/13/2017 11:04:17][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 11:04:17][             CostAllocation_Validation()] Starting Function
[06/13/2017 11:04:18][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 11:04:18][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 11:04:18][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 11:04:25][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 11:04:25][             CostAllocation_Validation()] Starting Function
[06/13/2017 11:04:25][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 11:04:26][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:04:26][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:04:26][                          PrintCalling()] Starting function
[06/13/2017 11:04:28][                          PrintCalling()] Loading Layout 
[06/13/2017 11:04:30][                          PrintCalling()] Assinging DS to Layout
[06/13/2017 11:04:31][                          PrintCalling()] Starting Printing
[06/13/2017 11:04:31][                          PrintCalling()] Default Printer name Microsoft XPS Document Writer
[06/13/2017 11:04:35][                          PrintCalling()] Completed with SUCCESS
[06/13/2017 11:04:40][                       MAtrixToDataTable] Starting Function
[06/13/2017 11:04:40][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:04:40][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:04:40][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:04:41][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:04:42][                       MAtrixToDataTable] Completed with SUCCESS 
[06/13/2017 11:04:42][                          PrintCalling()] Starting function
[06/13/2017 11:04:42][                          PrintCalling()] Loading Layout 
[06/13/2017 11:04:43][                          PrintCalling()] Assigning DS to Layout 
[06/13/2017 11:04:43][                          PrintCalling()] DS Count 0
[06/13/2017 11:04:43][                          PrintCalling()] 1 
[06/13/2017 11:04:43][                          PrintCalling()] 2 
[06/13/2017 11:04:43][                          PrintCalling()] Starting Printing Layout
[06/13/2017 11:04:43][                          PrintCalling()] Default Printer name Microsoft XPS Document Writer
[06/13/2017 11:04:49][                          PrintCalling()] Completed with SUCCESS
[06/13/2017 11:04:54][                       MAtrixToDataTable] Starting Function
[06/13/2017 11:04:54][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode], T0.[PrcName], T0.[U_AB_ENTITY], T1.[AcctCode], T1.[AcctName] FROM OPRC T0 join OACT T1 on T1.Details  like '%' + T0.U_AB_ENTITY + '%' WHERE T0.[DimCode] = 3
[06/13/2017 11:04:54][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:04:55][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:04:55][                       MAtrixToDataTable] SQL SELECT T0.[PrcCode] 'OU' , T0.[U_AB_REPORTCODE] 'BU' , T1.[U_AB_REPORTCODE] 'LOS' FROM OPRC T0 left outer join  OPRC T1 on T0.U_AB_REPORTCODE =  T1.PrcCode
[06/13/2017 11:04:55][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:04:55][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:04:55][                       MAtrixToDataTable] SQL SELECT T0.[U_AB_USERCODE], T0.[U_AB_PASSWORD], T0.[U_AB_COMCODE], T0.[U_AB_COMPANYNAME], T0.[U_AB_GROUP], T0.[U_AB_JVCREDIT] , T0.[U_AB_JVDEBIT], T0.[U_AB_NONJVCREDIT], T0.[U_AB_DEPACC], T0.[U_AB_DEPALLACC] FROM [dbo].[@AB_COMPANYDATA]  T0
[06/13/2017 11:04:55][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:04:56][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:04:56][                       MAtrixToDataTable] 1
[06/13/2017 11:04:56][                       MAtrixToDataTable] 2
[06/13/2017 11:04:56][                       MAtrixToDataTable] 3
[06/13/2017 11:04:56][                       MAtrixToDataTable] 5
[06/13/2017 11:04:56][                       MAtrixToDataTable] 61
[06/13/2017 11:04:56][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:56][                       MAtrixToDataTable] 9
[06/13/2017 11:04:56][                       MAtrixToDataTable] 10
[06/13/2017 11:04:56][                       MAtrixToDataTable] 5
[06/13/2017 11:04:56][                       MAtrixToDataTable] 61
[06/13/2017 11:04:56][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:56][                       MAtrixToDataTable] 9
[06/13/2017 11:04:56][                       MAtrixToDataTable] 10
[06/13/2017 11:04:57][                       MAtrixToDataTable] 5
[06/13/2017 11:04:57][                       MAtrixToDataTable] 61
[06/13/2017 11:04:57][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:57][                       MAtrixToDataTable] 9
[06/13/2017 11:04:57][                       MAtrixToDataTable] 10
[06/13/2017 11:04:57][                       MAtrixToDataTable] 5
[06/13/2017 11:04:57][                       MAtrixToDataTable] 61
[06/13/2017 11:04:57][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:57][                       MAtrixToDataTable] 9
[06/13/2017 11:04:57][                       MAtrixToDataTable] 10
[06/13/2017 11:04:57][                       MAtrixToDataTable] 5
[06/13/2017 11:04:57][                       MAtrixToDataTable] 61
[06/13/2017 11:04:57][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:57][                       MAtrixToDataTable] 9
[06/13/2017 11:04:57][                       MAtrixToDataTable] 10
[06/13/2017 11:04:58][                       MAtrixToDataTable] 5
[06/13/2017 11:04:58][                       MAtrixToDataTable] 61
[06/13/2017 11:04:58][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:58][                       MAtrixToDataTable] 9
[06/13/2017 11:04:58][                       MAtrixToDataTable] 10
[06/13/2017 11:04:58][                       MAtrixToDataTable] 5
[06/13/2017 11:04:58][                       MAtrixToDataTable] 61
[06/13/2017 11:04:58][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:58][                       MAtrixToDataTable] 9
[06/13/2017 11:04:58][                       MAtrixToDataTable] 10
[06/13/2017 11:04:58][                       MAtrixToDataTable] 5
[06/13/2017 11:04:58][                       MAtrixToDataTable] 61
[06/13/2017 11:04:58][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:58][                       MAtrixToDataTable] 9
[06/13/2017 11:04:58][                       MAtrixToDataTable] 10
[06/13/2017 11:04:59][                       MAtrixToDataTable] 5
[06/13/2017 11:04:59][                       MAtrixToDataTable] 61
[06/13/2017 11:04:59][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:59][                       MAtrixToDataTable] 9
[06/13/2017 11:04:59][                       MAtrixToDataTable] 10
[06/13/2017 11:04:59][                       MAtrixToDataTable] 5
[06/13/2017 11:04:59][                       MAtrixToDataTable] 61
[06/13/2017 11:04:59][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:04:59][                       MAtrixToDataTable] 9
[06/13/2017 11:04:59][                       MAtrixToDataTable] 10
[06/13/2017 11:05:00][                       MAtrixToDataTable] 5
[06/13/2017 11:05:00][                       MAtrixToDataTable] 61
[06/13/2017 11:05:00][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:05:00][                       MAtrixToDataTable] 9
[06/13/2017 11:05:00][                       MAtrixToDataTable] 10
[06/13/2017 11:05:00][                       MAtrixToDataTable] 5
[06/13/2017 11:05:00][                       MAtrixToDataTable] 61
[06/13/2017 11:05:00][                       MAtrixToDataTable] 7GHRS
[06/13/2017 11:05:00][                       MAtrixToDataTable] 9
[06/13/2017 11:05:00][                       MAtrixToDataTable] 10
[06/13/2017 11:05:00][                       MAtrixToDataTable] 5
[06/13/2017 11:05:00][                       MAtrixToDataTable] 5
[06/13/2017 11:05:00][                       MAtrixToDataTable] 5
[06/13/2017 11:05:00][                       MAtrixToDataTable] Completed with SUCCESS 
[06/13/2017 11:05:01][             SBO_Application_ItemEvent()] Calling ConnectToTargetCompany()
[06/13/2017 11:05:01][                ConnectToTargetCompany()] Starting function
[06/13/2017 11:05:01][                ConnectToTargetCompany()] Initializing the Company Object
[06/13/2017 11:05:01][                ConnectToTargetCompany()] Assigning the representing database name
[06/13/2017 11:05:01][                ConnectToTargetCompany()] Connecting to the Company Database. GHRS
[06/13/2017 11:05:05][                ConnectToTargetCompany()] Completed with ERROR
[06/13/2017 11:05:05][             SBO_Application_ItemEvent()] Completed with ERROR
[06/13/2017 11:11:13][                                  Main()] Starting Addon startup function
[06/13/2017 11:11:14][                                  Main()] Initializing public SBO Application object
[06/13/2017 11:11:14][                                  Main()] Retriving SBO application company handle
[06/13/2017 11:11:17][                                  Main()] Retrived SBO application company handle
[06/13/2017 11:11:17][                                  Main()] Calling ConnectDICompSSO()
[06/13/2017 11:11:17][                      ConnectDICompSSO()] Starting function
[06/13/2017 11:11:29][                      ConnectDICompSSO()] Completed with SUCCESS
[06/13/2017 11:11:29][                                  Main()] Creating Event handler class
[06/13/2017 11:11:29][                      Class_Initialize()] Starting function
[06/13/2017 11:11:29][                      Class_Initialize()] Retriving SBO Application handle
[06/13/2017 11:11:29][                      Class_Initialize()] Completed with SUCCESS
[06/13/2017 11:11:29][                                  Main()] Calling AddMenuItems()
[06/13/2017 11:11:29][                                  Main()] Calling SetApplication Function
[06/13/2017 11:11:29][                                  Main()] Addon started successfully
[06/13/2017 11:12:04][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 11:12:04][             SBO_Application_MenuEvent()] Completed with SUCCESS
[06/13/2017 11:12:04][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 11:13:06][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[06/13/2017 11:13:32][              Header Show button click()] Calling HeaderValidation()
[06/13/2017 11:13:32][             CostAllocation_Validation()] Starting Function
[06/13/2017 11:13:32][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 11:13:32][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 11:13:33][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 11:13:37][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[06/13/2017 11:13:41][             SBO_Application_ItemEvent()] Added 52111
[06/13/2017 11:13:45][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 11:13:45][             CostAllocation_Validation()] Starting Function
[06/13/2017 11:13:45][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 11:13:45][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 11:13:46][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 11:13:55][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 11:13:55][             CostAllocation_Validation()] Starting Function
[06/13/2017 11:13:55][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 11:13:55][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:13:55][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:13:55][                          PrintCalling()] Starting function
[06/13/2017 11:13:57][                          PrintCalling()] Loading Layout 
[06/13/2017 11:13:59][                          PrintCalling()] Assinging DS to Layout
[06/13/2017 11:14:00][                          PrintCalling()] Starting Printing
[06/13/2017 11:14:00][                          PrintCalling()] Default Printer name Microsoft XPS Document Writer
[06/13/2017 11:14:04][                          PrintCalling()] Completed with SUCCESS
[06/13/2017 11:14:08][                       MAtrixToDataTable] Starting Function
[06/13/2017 11:14:08][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:14:08][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:14:08][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:14:09][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 11:14:47][                       MAtrixToDataTable] Completed with SUCCESS 
[06/13/2017 11:14:47][                          PrintCalling()] Starting function
[06/13/2017 11:14:47][                          PrintCalling()] Loading Layout 
[06/13/2017 11:14:48][                          PrintCalling()] Assigning DS to Layout 
[06/13/2017 11:14:48][                          PrintCalling()] DS Count 0
[06/13/2017 11:14:48][                          PrintCalling()] 1 
[06/13/2017 11:14:48][                          PrintCalling()] 2 
[06/13/2017 11:14:48][                          PrintCalling()] Starting Printing Layout
[06/13/2017 11:14:48][                          PrintCalling()] Default Printer name Microsoft XPS Document Writer
[06/13/2017 11:14:53][                          PrintCalling()] Completed with SUCCESS
[06/13/2017 11:15:12][                       MAtrixToDataTable] Starting Function
[06/13/2017 11:15:14][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 11:15:14][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 12:15:09][                                  Main()] Starting Addon startup function
[06/13/2017 12:15:10][                                  Main()] Initializing public SBO Application object
[06/13/2017 12:15:10][                                  Main()] Retriving SBO application company handle
[06/13/2017 12:15:13][                                  Main()] Retrived SBO application company handle
[06/13/2017 12:15:13][                                  Main()] Calling ConnectDICompSSO()
[06/13/2017 12:15:13][                      ConnectDICompSSO()] Starting function
[06/13/2017 12:15:29][                      ConnectDICompSSO()] Completed with SUCCESS
[06/13/2017 12:15:29][                                  Main()] Creating Event handler class
[06/13/2017 12:15:29][                      Class_Initialize()] Starting function
[06/13/2017 12:15:29][                      Class_Initialize()] Retriving SBO Application handle
[06/13/2017 12:15:29][                      Class_Initialize()] Completed with SUCCESS
[06/13/2017 12:15:29][                                  Main()] Calling AddMenuItems()
[06/13/2017 12:15:29][                                  Main()] Calling SetApplication Function
[06/13/2017 12:15:29][                                  Main()] Addon started successfully
[06/13/2017 12:15:55][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 12:15:55][             SBO_Application_MenuEvent()] Completed with SUCCESS
[06/13/2017 12:15:55][             SBO_Application_MenuEvent()] Starting function
[06/13/2017 12:16:10][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[OcrCode], T0.[OcrName], 'N' [Active] FROM OOCR T0 WHERE T0.[DimCode] = 3
[06/13/2017 12:16:40][              Header Show button click()] Calling HeaderValidation()
[06/13/2017 12:16:40][             CostAllocation_Validation()] Starting Function
[06/13/2017 12:16:40][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 12:16:40][              Header Show button click()] Tab 2 DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max), @query1  AS VARCHAR(max), @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], CAST(Line AS DECIMAL(19,3)) [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3) and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 12:16:42][              Header Show button click()] Tab 3  select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup], b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] ,b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30', '1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') , b.OcrCode3 ,c.transType UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct] FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,''), b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 12:16:45][             SBO_Application_ItemEvent()] CFL Load SELECT T0.[PrcCode], T0.[PrcName], 'N' [Active], U_AB_ENTITYNAME FROM OPRC T0  WHERE T0.[DimCode] = 3 order by U_AB_ENTITYNAME
[06/13/2017 12:16:49][             SBO_Application_ItemEvent()] Added 52111
[06/13/2017 12:16:53][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 12:16:53][             CostAllocation_Validation()] Starting Function
[06/13/2017 12:16:53][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 12:16:53][      Summary Report Show button click()] SummaryReport show button click DECLARE @cols AS NVARCHAR(MAX),    @query  AS VARCHAR(max) , @query1  AS VARCHAR(max),  @cols1 as nvarchar(max) select @cols = STUFF((SELECT distinct  ',' + QUOTENAME(cast(T1.PrcCode as nvarchar(100)))  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'') select @cols1 = STUFF((SELECT '+ isnull(' + QUOTENAME(isnull(T1.PrcCode,0)) + ',0)'  from OOCR T0  INNER JOIN OCR1 T1 ON T0.[OcrCode] = T1.[OcrCode]  where T0.OcrCode in ('HC1') and T1.[ValidFrom] <= '20160901' and  (T1.[ValidTo] >= '20160901' or  isnull(T1.[ValidTo],'') = '') and T1.PrcCode in ('52111')  FOR XML PATH(''), TYPE  ).value('.', 'NVARCHAR(MAX)')   ,1,1,'')  set @query = cast('SELECT SeriesName , ''PU '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , PDocNum ''Payment Doc Num'', PDocDate ''Payment Doc Date'' ,  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator] , plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], l.DocNum [PDocNum] , l.DocDate [PDocDate] , g.LineNum ,   case when g.BaseType = 18 then -sum(isnull(g.LineTotal,0)) else sum(isnull(g.LineTotal,0)) end [Line] ,  case when g.BaseType = 18 then -sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else sum( round(isnull(g.LineTotal,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total , j.[U_NAME] +'', '' + j.[USER_CODE][Creator]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OPCH f on c.[TransId] = f.[TransId]  JOIN PCH1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  left join   [VPM2] k on f.DocEntry = k.DocEntry left JOIN OVPM l ON k.[DocNum] = l.[DocEntry]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''18'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  and (case when isnull(l.DocNum,'''') = '''' then ''N'' else l.Canceled end)=''N''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum, i.SeriesName ,j.[U_NAME] , j.[USER_CODE], l.DocNum , l.DocDate , g.BaseType  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p   union all SELECT SeriesName, ''PC '' + cast(DOCNUM as varchar(30)) ''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'',  NUMATCARD ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   CARDNAME ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', SLPNAME ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME  , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT], g.LineNum,  case when g.BaseType = ''19'' then   sum(ISNULL( g.LineTotal,0))  else  - sum(ISNULL( g.LineTotal,0))  end [Line] ,  case when g.BaseType = ''19'' then  sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) else - sum( round((isnull( g.LineTotal,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) end AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN ORPC f on c.[TransId] = f.[TransId]  JOIN RPC1 g on g.[DocEntry] = f.[DocEntry] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN OSLP h on f.SLPCODE=h.SLPCODE   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''19'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM   , f.NUMATCARD  ,f.TAXDATE  ,f.DOCDATE  ,f.CARDNAME  ,f.JRNLMEMO  ,  b.[OcrCode3]  ,h.SLPNAME , g.LineNum , i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ,g.BaseType ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  set @query1 = cast( ' union all SELECT SeriesName, ''JE '' + cast(Number as varchar(30)) ''SAP Reference Number''  , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,REF2 ''Vendor Invoice Number'' , TAXDATE ''Vendor Invoice Date'' ,REFDATE ''SAP Posting Date''  ,''JE'' ''Vendor / Payee Name'',MEMO ''Journal Remark'' ,  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses],  Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName, c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT] , j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,   sum( round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total , sum(ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) [Line]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]   LEFT JOIN NNM1 i on i.Series=c.Series   LEFT JOIN OUSR j on  c.[usersign] = j.[USERID] where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''30'',''1470000071'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by c.Number   , b.REF2  ,b.TAXDATE  ,c.REFDATE  ,c.MEMO  ,  b.[OcrCode3]  , a.AcctCode , a.AcctName , e.[PrcCode],i.SeriesName,j.[U_NAME] , j.[USER_CODE]    ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.TAXDATE  ,f.DOCDATE   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  sum(isnull(g.SumApplied,0)) [Line] , sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account  and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A''   group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.TAXDATE  ,f.DOCDATE  ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE] ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p  UNION ALL SELECT  SeriesName, ''PS '' + cast(DOCNUM as varchar(30))''SAP Reference Number'' , '''' ''Payment Doc Num'', NULL ''Payment Doc Date'' ,'''' ''Vendor Invoice Number'',TAXDATE ''Vendor Invoice Date'',DOCDATE ''SAP Posting Date'',   Address ''Vendor / Payee Name'',JRNLMEMO ''Journal Remark'',  [OcrCode3] ''Distribution Code'', '''' ''Purchasing Department'', Creator [Document Creator], plan_id [Expenses], Line [Total Bill],' + @cols + '   from ( SELECT i.SeriesName,f.DOCNUM   ,f.CancelDate [TAXDATE]  ,f.CancelDate [DOCDATE]   ,f.JRNLMEMO  ,  b.[OcrCode3]   ,a.AcctCode + '' - '' + a.AcctName [plan_id] , e.[PrcCode] [U_AB_NONPROJECT],  f.[Address] , g.LineId ,  j.[U_NAME] +'', '' + j.[USER_CODE][Creator] ,  -sum(isnull(g.SumApplied,0)) [Line] , -sum( round(isnull(g.SumApplied,0) /(d.[OcrTotal] /e.[PrcAmount] ),3)) AS total  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]  left join OOCR d on d.OcrCode = b.OcrCode3  join OCR1 e on d.[OcrCode] = e.[OcrCode]  JOIN OVPM f on c.[TransId] = f.[TransId]  JOIN VPM4 g on g.[DocNum] = f.[DocNum] and g.AcctCode = b.Account   and  g.[OcrCode3] =  b.[OcrCode3]   LEFT JOIN NNM1 i on i.Series=f.Series    LEFT JOIN OUSR j on  f.[usersign] = j.[USERID]  where  b.OcrCode3 in (''HC1'') and a.GroupMask = 5  and isnull(c.Indicator,'''') <> ''CA'' and 	b.Account >= ''700000000000000'' and b.Account <= ''91101000'' and c.transType IN (''46'') and month(f.CancelDate) >= 9 and month(f.CancelDate) <= 9 and year(f.CancelDate) = 2016  and  e.[ValidFrom] <= ''20160901'' and (e.[ValidTo] >= ''20160901'' or  isnull(e.[ValidTo],'''') = '''') and e.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)   and f.DocType = ''A'' and f.Canceled = ''Y''  group by a.AcctCode,a.AcctName,e.[PrcCode] , f.DOCNUM ,f.CancelDate ,f.JRNLMEMO  ,  b.[OcrCode3]  , g.LineId , f.[Address],i.SeriesName ,j.[U_NAME] , j.[USER_CODE]  ) x pivot ( sum(total)    for U_AB_NONPROJECT in (' + @cols + ')  ) p ' as nvarchar(max))  execute (@query + @query1)
[06/13/2017 12:16:53][      Summary Report Show button click()] Tab 3 - Show butto click select * from (SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OPCH d on c.[TransId] = d.[TransId]   JOIN PCH1 e on e.[DocEntry] = d.[DocEntry] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('18') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project], e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit,isnull( b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER ,  b.TransId, d.DocEntry [BaseRef] , 'CN' 'LineMemo'   , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]   FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   JOIN ORPC d on c.[TransId] = d.[TransId]  JOIN RPC1 e on e.[DocEntry] = d.[DocEntry]  and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(d.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('19') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111') and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  , isnull( e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, d.DocEntry  , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') , b.OcrCode3   UNION ALL  SELECT   a.AcctCode [Account], a.AcctName [ShortName], b.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(b.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName] ,  round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] ,  isnull(g.Name,'')  U_AB_PARTNER ,  b.TransId, 0 [BaseRef] , case when c.transType = '30' then case when left(a.AcctCode,4) = '7212' or left(a.AcctCode,4) = '7213' then  'DEP' else 'JE' end  else 'DEP' end 'LineMemo', isnull(b.OcrCode2,'') [BU] , isnull(b.ProfitCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]    FROM JDT1 b JOIN OACT a  ON a.AcctCode = b.Account  JOIN OJDT c on b.[TransId] = c.[TransId]   left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode]  left outer join OPRC f on f.PrcCode = e1.PrcCode left outer join [@AB_PARTNER] g on g.Code = b.U_AB_PARTNER where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and isnull(c.Indicator,'') <> 'CA' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('30','1470000071') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , b.U_AB_NONPROJECT  , isnull( b.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount],isnull( b.LineMemo,'') ,  b.TransId, isnull( b.OcrCode2,'')   , isnull(b.ProfitCode,''), isnull(g.Name,''),isnull( b.VatGroup  ,'') ,b.OcrCode3 ,c.transType  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(c.refdate) >= 9 and month(c.refdate) <= 9 and year(c.refdate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3  UNION ALL SELECT a.AcctCode [Account], a.AcctName [ShortName], e.U_AB_NONPROJECT [U_AB_NONPROJECT],  isnull(e.Project,'') [Project] ,e1.PrcCode [OcrCode3] , f.PrcName [U_AB_OUName], -round((ISNULL(b.Debit,0) - ISNULL(b.Credit,0)) /(d1.[OcrTotal] /e1.[PrcAmount] ),3) AS Credit, isnull(b.LineMemo,'') [U_AB_REMARKS] , '' U_AB_PARTNER, b.TransId, d.DocEntry [BaseRef] , 'AP' 'LineMemo'  , isnull(e.OcrCode2,'') [BU], isnull(e.OcrCode,'') [LOS] , isnull( b.VatGroup  ,'') [VatGroup] , b.OcrCode3 [ContraAct]  FROM JDT1 b JOIN OACT a ON a.AcctCode = b.Account   JOIN OJDT c on b.[TransId] = c.[TransId]  JOIN OVPM d on c.[TransId] = d.[TransId]   JOIN VPM4 e on e.[DocNum] = d.[DocNum] and e.AcctCode = b.Account  and e.[OcrCode3] = b.[OcrCode3]  left join OOCR d1 on d1.OcrCode = b.OcrCode3  join OCR1 e1 on d1.[OcrCode] = e1.[OcrCode] left outer join OPRC f on f.PrcCode = e1.PrcCode  where  b.OcrCode3 in ('HC1') and a.GroupMask = 5  and d.DocType = 'A' and d.Canceled = 'Y' and 	b.Account >= '700000000000000' and b.Account <= '91101000' and c.transType IN ('46') and month(d.CancelDate) >= 9 and month(d.CancelDate) <= 9 and year(d.CancelDate) = 2016  and  e1.[ValidFrom] <= '20160901' and (e1.[ValidTo] >= '20160901' or  isnull(e1.[ValidTo],'') = '') and e1.PrcCode in ('52111')  and e1.PrcCode not in (SELECT T0.[U_PrcCode] FROM [dbo].[@AB_COSTALLOCATION]  T0 WHERE T0.[U_Transid] = c.TransId and T0.U_OcrCode3 = b.OcrCode3)  group by   a.AcctCode  , a.AcctName  , e.U_AB_NONPROJECT  ,  isnull(e.Project,'') ,e1.PrcCode  , f.PrcName  ,  b.Debit, b.Credit,d1.[OcrTotal],e1.[PrcAmount], isnull(b.LineMemo,'') ,  b.TransId, d.DocEntry , isnull(e.OcrCode2,'')  , isnull(e.OcrCode ,'') ,isnull( b.VatGroup  ,'') ,b.OcrCode3 )x order by x.OcrCode3 , cast(x.Account as integer)
[06/13/2017 12:17:01][      Summary Report Show button click()] Calling HeaderValidation()
[06/13/2017 12:17:01][             CostAllocation_Validation()] Starting Function
[06/13/2017 12:17:01][             CostAllocation_Validation()] Completed with SUCCESS
[06/13/2017 12:17:01][           ConvertRecordsetToDataTable()] Starting Fuction 
[06/13/2017 12:17:02][           ConvertRecordsetToDataTable()] Completed with SUCCESS 
[06/13/2017 12:17:02][                          PrintCalling()] Starting function
[06/13/2017 12:17:03][                          PrintCalling()] Loading Layout 
[06/13/2017 12:17:07][                          PrintCalling()] Assinging DS to Layout
[06/13/2017 12:17:07][                          PrintCalling()] Starting Printing
[06/13/2017 12:17:07][                          PrintCalling()] Default Printer name Microsoft XPS Document Writer
[06/13/2017 12:17:22][                          PrintCalling()] Completed with SUCCESS
